<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Origami::PDF</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Origami::PDF</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/origami/file_rb.html">
                origami/file.rb
                </a>
        <br />
                <a href="../../files/origami/acroform_rb.html">
                origami/acroform.rb
                </a>
        <br />
                <a href="../../files/origami/encryption_rb.html">
                origami/encryption.rb
                </a>
        <br />
                <a href="../../files/origami/xfa_rb.html">
                origami/xfa.rb
                </a>
        <br />
                <a href="../../files/origami/metadata_rb.html">
                origami/metadata.rb
                </a>
        <br />
                <a href="../../files/origami/actions_rb.html">
                origami/actions.rb
                </a>
        <br />
                <a href="../../files/origami/pdf_rb.html">
                origami/pdf.rb
                </a>
        <br />
                <a href="../../files/origami/destinations_rb.html">
                origami/destinations.rb
                </a>
        <br />
                <a href="../../files/origami/parsers/pdf/linear_rb.html">
                origami/parsers/pdf/linear.rb
                </a>
        <br />
                <a href="../../files/origami/catalog_rb.html">
                origami/catalog.rb
                </a>
        <br />
                <a href="../../files/origami/page_rb.html">
                origami/page.rb
                </a>
        <br />
                <a href="../../files/origami/header_rb.html">
                origami/header.rb
                </a>
        <br />
                <a href="../../files/origami/trailer_rb.html">
                origami/trailer.rb
                </a>
        <br />
                <a href="../../files/origami/export_rb.html">
                origami/export.rb
                </a>
        <br />
                <a href="../../files/origami/xreftable_rb.html">
                origami/xreftable.rb
                </a>
        <br />
                <a href="../../files/origami/linearization_rb.html">
                origami/linearization.rb
                </a>
        <br />
                <a href="../../files/origami/signature_rb.html">
                origami/signature.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Main class representing a <a href="PDF.html">PDF</a> file and its inner
contents. A <a href="PDF.html">PDF</a> file contains a set of <a
href="PDF/Revision.html">Revision</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000537">&lt;&lt;</a>&nbsp;&nbsp;
      <a href="#M000551">Catalog</a>&nbsp;&nbsp;
      <a href="#M000552">Catalog=</a>&nbsp;&nbsp;
      <a href="#M000507">add_fields</a>&nbsp;&nbsp;
      <a href="#M000544">add_new_revision</a>&nbsp;&nbsp;
      <a href="#M000539">add_to_revision</a>&nbsp;&nbsp;
      <a href="#M000540">alloc_new_object_number</a>&nbsp;&nbsp;
      <a href="#M000560">append_page</a>&nbsp;&nbsp;
      <a href="#M000534">append_subobj</a>&nbsp;&nbsp;
      <a href="#M000502">attach_file</a>&nbsp;&nbsp;
      <a href="#M000541">compile</a>&nbsp;&nbsp;
      <a href="#M000522">create</a>&nbsp;&nbsp;
      <a href="#M000506">create_acroform</a>&nbsp;&nbsp;
      <a href="#M000514">create_xfa_form</a>&nbsp;&nbsp;
      <a href="#M000512">decrypt</a>&nbsp;&nbsp;
      <a href="#M000546">delete_object</a>&nbsp;&nbsp;
      <a href="#M000570">delete_xrefstm</a>&nbsp;&nbsp;
      <a href="#M000572">delinearize!</a>&nbsp;&nbsp;
      <a href="#M000523">deserialize</a>&nbsp;&nbsp;
      <a href="#M000509">each_field</a>&nbsp;&nbsp;
      <a href="#M000557">each_name</a>&nbsp;&nbsp;
      <a href="#M000549">each_named_dest</a>&nbsp;&nbsp;
      <a href="#M000504">each_named_embedded_file</a>&nbsp;&nbsp;
      <a href="#M000566">each_named_page</a>&nbsp;&nbsp;
      <a href="#M000520">each_named_script</a>&nbsp;&nbsp;
      <a href="#M000563">each_page</a>&nbsp;&nbsp;
      <a href="#M000575">enable_usage_rights</a>&nbsp;&nbsp;
      <a href="#M000513">encrypt</a>&nbsp;&nbsp;
      <a href="#M000567">export_to_graph</a>&nbsp;&nbsp;
      <a href="#M000568">export_to_graphml</a>&nbsp;&nbsp;
      <a href="#M000508">fields</a>&nbsp;&nbsp;
      <a href="#M000526">filesize</a>&nbsp;&nbsp;
      <a href="#M000532">find</a>&nbsp;&nbsp;
      <a href="#M000548">get_destination_by_name</a>&nbsp;&nbsp;
      <a href="#M000517">get_document_info</a>&nbsp;&nbsp;
      <a href="#M000503">get_embedded_file_by_name</a>&nbsp;&nbsp;
      <a href="#M000510">get_field</a>&nbsp;&nbsp;
      <a href="#M000518">get_metadata</a>&nbsp;&nbsp;
      <a href="#M000564">get_page</a>&nbsp;&nbsp;
      <a href="#M000565">get_page_by_name</a>&nbsp;&nbsp;
      <a href="#M000519">get_script_by_name</a>&nbsp;&nbsp;
      <a href="#M000515">has_document_info?</a>&nbsp;&nbsp;
      <a href="#M000505">has_form?</a>&nbsp;&nbsp;
      <a href="#M000516">has_metadata?</a>&nbsp;&nbsp;
      <a href="#M000576">has_usage_rights?</a>&nbsp;&nbsp;
      <a href="#M000535">indirect_objects</a>&nbsp;&nbsp;
      <a href="#M000538">insert</a>&nbsp;&nbsp;
      <a href="#M000561">insert_page</a>&nbsp;&nbsp;
      <a href="#M000511">is_encrypted?</a>&nbsp;&nbsp;
      <a href="#M000571">is_linearized?</a>&nbsp;&nbsp;
      <a href="#M000574">is_signed?</a>&nbsp;&nbsp;
      <a href="#M000530">ls</a>&nbsp;&nbsp;
      <a href="#M000559">ls_names</a>&nbsp;&nbsp;
      <a href="#M000531">ls_no_follow</a>&nbsp;&nbsp;
      <a href="#M000524">new</a>&nbsp;&nbsp;
      <a href="#M000533">objects</a>&nbsp;&nbsp;
      <a href="#M000554">onDocumentClose</a>&nbsp;&nbsp;
      <a href="#M000553">onDocumentOpen</a>&nbsp;&nbsp;
      <a href="#M000555">onDocumentPrint</a>&nbsp;&nbsp;
      <a href="#M000562">pages</a>&nbsp;&nbsp;
      <a href="#M000547">physicalize</a>&nbsp;&nbsp;
      <a href="#M000521">read</a>&nbsp;&nbsp;
      <a href="#M000543">rebuildxrefs</a>&nbsp;&nbsp;
      <a href="#M000556">register</a>&nbsp;&nbsp;
      <a href="#M000545">remove_revision</a>&nbsp;&nbsp;
      <a href="#M000569">remove_xrefs</a>&nbsp;&nbsp;
      <a href="#M000558">resolve_name</a>&nbsp;&nbsp;
      <a href="#M000536">root_objects</a>&nbsp;&nbsp;
      <a href="#M000527">save</a>&nbsp;&nbsp;
      <a href="#M000529">save_upto</a>&nbsp;&nbsp;
      <a href="#M000528">saveas</a>&nbsp;&nbsp;
      <a href="#M000525">serialize</a>&nbsp;&nbsp;
      <a href="#M000550">set_extension_level</a>&nbsp;&nbsp;
      <a href="#M000573">sign</a>&nbsp;&nbsp;
      <a href="#M000542">to_bin</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="PDF/Header.html" class="link">Origami::PDF::Header</a><br />
Class <a href="PDF/Instruction.html" class="link">Origami::PDF::Instruction</a><br />
Class <a href="PDF/LinearParser.html" class="link">Origami::PDF::LinearParser</a><br />
Class <a href="PDF/Revision.html" class="link">Origami::PDF::Revision</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">V</td>
          <td>=</td>
          <td class="context-item-value">version</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">R</td>
          <td>=</td>
          <td class="context-item-value">revision</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Length</td>
          <td>=</td>
          <td class="context-item-value">params[:key_size]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">P</td>
          <td>=</td>
          <td class="context-item-value">-1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">EncryptMetadata</td>
          <td>=</td>
          <td class="context-item-value">params[:encrypt_metadata]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CF</td>
          <td>=</td>
          <td class="context-item-value">Dictionary.new</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">AuthEvent</td>
          <td>=</td>
          <td class="context-item-value">:DocOpen</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CFM</td>
          <td>=</td>
          <td class="context-item-value">:AESV2</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CFM</td>
          <td>=</td>
          <td class="context-item-value">:AESV3</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Length</td>
          <td>=</td>
          <td class="context-item-value">params[:key_size] &gt;&gt; 3</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">StmF</td>
          <td>=</td>
          <td class="context-item-value">handler.StrF = :StdCF</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">XFA</td>
          <td>=</td>
          <td class="context-item-value">Stream.new(xdp, :Filter =&gt; :FlateDecode)</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">W</td>
          <td>=</td>
          <td class="context-item-value">[ 1, (xrefstm_offset.to_s(2).size + 7) &gt;&gt; 3, 2 ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Prev</td>
          <td>=</td>
          <td class="context-item-value">prev_xref_offset</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Size</td>
          <td>=</td>
          <td class="context-item-value">objset.size + 1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Prev</td>
          <td>=</td>
          <td class="context-item-value">prev_xref_offset</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">XRefStm</td>
          <td>=</td>
          <td class="context-item-value">xrefstm_offset if options[:use_xrefstm] == true</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Size</td>
          <td>=</td>
          <td class="context-item-value">size + 1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Root</td>
          <td>=</td>
          <td class="context-item-value">root</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Catalog</td>
          <td>=</td>
          <td class="context-item-value">(get_doc_attr(:Root) || Catalog.new))</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Pages</td>
          <td>=</td>
          <td class="context-item-value">PageTreeNode.new.set_indirect(true)</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Root</td>
          <td>=</td>
          <td class="context-item-value">catalog.reference</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Size</td>
          <td>=</td>
          <td class="context-item-value">size + 1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BaseVersion</td>
          <td>=</td>
          <td class="context-item-value">Name.new(version)</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ExtensionLevel</td>
          <td>=</td>
          <td class="context-item-value">level</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Root</td>
          <td>=</td>
          <td class="context-item-value">self &lt;&lt; cat</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">OpenAction</td>
          <td>=</td>
          <td class="context-item-value">action</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">WC</td>
          <td>=</td>
          <td class="context-item-value">action</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">WP</td>
          <td>=</td>
          <td class="context-item-value">action</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Count</td>
          <td>=</td>
          <td class="context-item-value">treeroot.Kids.length</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Parent</td>
          <td>=</td>
          <td class="context-item-value">treeroot</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ID</td>
          <td>=</td>
          <td class="context-item-value">[ id, id ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Rect</td>
          <td>=</td>
          <td class="context-item-value">Rectangle[:llx =&gt; 0.0, :lly =&gt; 0.0, :urx =&gt; 0.0, :ury =&gt; 0.0]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">V</td>
          <td>=</td>
          <td class="context-item-value">digsig ;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SigFlags</td>
          <td>=</td>
          <td class="context-item-value">InteractiveForm::SigFlags::SIGNATURESEXIST | InteractiveForm::SigFlags::APPENDONLY</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Location</td>
          <td>=</td>
          <td class="context-item-value">HexaString.new(location) if location</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ContactInfo</td>
          <td>=</td>
          <td class="context-item-value">HexaString.new(contact) if contact</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Reason</td>
          <td>=</td>
          <td class="context-item-value">HexaString.new(reason) if reason</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Data</td>
          <td>=</td>
          <td class="context-item-value">self.Catalog</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">TransformParams</td>
          <td>=</td>
          <td class="context-item-value">UsageRights::TransformParams.new</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">V</td>
          <td>=</td>
          <td class="context-item-value">UsageRights::TransformParams::VERSION</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Reference</td>
          <td>=</td>
          <td class="context-item-value">[ sigref ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">UR3</td>
          <td>=</td>
          <td class="context-item-value">digsig</td>
        </tr>
        </table>
      </div>
    </div>

    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">get_object</td>
          <td>-&gt;</td>
          <td class="context-item-value">[]</td>
        </tr>
                        </table>
      </div>
    </div>


    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">header</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">revisions</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000522" class="method-detail">
        <a name="M000522"></a>

        <div class="method-heading">
          <a href="#M000522" class="method-signature">
          <span class="method-name">create</span><span class="method-args">(output, options = {}) {|pdf| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="PDF.html#M000524">new</a> <a href="PDF.html">PDF</a> and
saves it. If a block is passed, the <a href="PDF.html">PDF</a> instance can
be processed before saving.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000522-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000522-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 189</span>
189:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">output</span>, <span class="ruby-identifier">options</span> = {})
190:         <span class="ruby-identifier">pdf</span> = <span class="ruby-constant">PDF</span>.<span class="ruby-identifier">new</span>
191:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">pdf</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
192:         <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">save</span>(<span class="ruby-identifier">output</span>, <span class="ruby-identifier">options</span>)
193:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000523" class="method-detail">
        <a name="M000523"></a>

        <div class="method-heading">
          <a href="#M000523" class="method-signature">
          <span class="method-name">deserialize</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deserializes a <a href="PDF.html">PDF</a> dump.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000523-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000523-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 198</span>
198:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deserialize</span>(<span class="ruby-identifier">filename</span>)
199:         <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipReader</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">gz</span><span class="ruby-operator">|</span>
200:           <span class="ruby-identifier">pdf</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">gz</span>.<span class="ruby-identifier">read</span>)
201:         }
202:         
203:         <span class="ruby-identifier">pdf</span>
204:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000524" class="method-detail">
        <a name="M000524"></a>

        <div class="method-heading">
          <a href="#M000524" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(init_structure = true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="PDF.html#M000524">new</a> <a href="PDF.html">PDF</a>
instance.
</p>
<table>
<tr><td valign="top"><em>init_structure</em>:</td><td>If this flag is set, then some structures will be automatically generated
while manipulating this <a href="PDF.html">PDF</a>. Set it if you are
creating a <a href="PDF.html#M000524">new</a> <a href="PDF.html">PDF</a>
file, this <em>must</em> <em>not</em> be used when parsing an existing
file.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000524-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000524-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 211</span>
211:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">init_structure</span> = <span class="ruby-keyword kw">true</span>)
212:       <span class="ruby-ivar">@header</span> = <span class="ruby-constant">PDF</span><span class="ruby-operator">::</span><span class="ruby-constant">Header</span>.<span class="ruby-identifier">new</span>
213:       <span class="ruby-ivar">@revisions</span> = []
214:       
215:       <span class="ruby-identifier">add_new_revision</span>
216:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">trailer</span> = <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
217: 
218:       <span class="ruby-identifier">init</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">init_structure</span>
219:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000521" class="method-detail">
        <a name="M000521"></a>

        <div class="method-heading">
          <a href="#M000521" class="method-signature">
          <span class="method-name">read</span><span class="method-args">(filename, options = {:verbosity =&gt; Parser::VERBOSE_INSANE})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reads and parses a <a href="PDF.html">PDF</a> file from disk.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000521-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000521-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 181</span>
181:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:verbosity</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">VERBOSE_INSANE</span>})
182:         <span class="ruby-constant">PDF</span><span class="ruby-operator">::</span><span class="ruby-constant">LinearParser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">filename</span>)
183:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000537" class="method-detail">
        <a name="M000537"></a>

        <div class="method-heading">
          <a href="#M000537" class="method-signature">
          <span class="method-name">&lt;&lt;</span><span class="method-args">(object)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a <a href="PDF.html#M000524">new</a> object to the <a
href="PDF.html">PDF</a> file. If this object has no version number, then a
<a href="PDF.html#M000524">new</a> one will be automatically computed and
assignated to him. It returns a Reference to this <a
href="Object.html">Object</a>.
</p>
<table>
<tr><td valign="top"><em>object</em>:</td><td>The object to add.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000537-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000537-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 484</span>
484:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;&lt;</span>(<span class="ruby-identifier">object</span>)
485:       <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">object</span>, <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>)
486:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000551" class="method-detail">
        <a name="M000551"></a>

        <div class="method-heading">
          <a href="#M000551" class="method-signature">
          <span class="method-name">Catalog</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the current <a href="PDF.html#M000551">Catalog</a> <a
href="Dictionary.html">Dictionary</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000551-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000551-source">
<pre>
    <span class="ruby-comment cmt"># File origami/catalog.rb, line 46</span>
46:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Catalog</span>
47:       <span class="ruby-identifier">cat</span> = <span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:Root</span>)
48: 
49:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">cat</span>
50:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">then</span>
51:           <span class="ruby-identifier">cat</span>
52:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Dictionary</span> <span class="ruby-keyword kw">then</span>
53:           <span class="ruby-identifier">casted</span> = <span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cat</span>)
54:           <span class="ruby-identifier">casted</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">casted</span>.<span class="ruby-identifier">generation</span> = <span class="ruby-identifier">cat</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">cat</span>.<span class="ruby-identifier">generation</span>
55:           <span class="ruby-identifier">casted</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
56:           <span class="ruby-identifier">casted</span>.<span class="ruby-identifier">set_pdf</span>(<span class="ruby-keyword kw">self</span>)
57: 
58:           <span class="ruby-identifier">casted</span>
59:         <span class="ruby-keyword kw">else</span>
60:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Broken catalog&quot;</span>
61:       <span class="ruby-keyword kw">end</span>
62:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000552" class="method-detail">
        <a name="M000552"></a>

        <div class="method-heading">
          <a href="#M000552" class="method-signature">
          <span class="method-name">Catalog=</span><span class="method-args">(cat)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the current <a href="PDF.html#M000551">Catalog</a> <a
href="Dictionary.html">Dictionary</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000552-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000552-source">
<pre>
    <span class="ruby-comment cmt"># File origami/catalog.rb, line 67</span>
67:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Catalog=</span>(<span class="ruby-identifier">cat</span>)
68:       <span class="ruby-comment cmt">#unless cat.is_a?(Catalog)</span>
69:       <span class="ruby-comment cmt">#  raise TypeError, &quot;Expected type Catalog, received #{cat.class}&quot;</span>
70:       <span class="ruby-comment cmt">#end</span>
71:       <span class="ruby-identifier">cat</span> = <span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cat</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">cat</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Catalog</span>
72:       
73:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span>
74:         <span class="ruby-identifier">delete_object</span>(<span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>[<span class="ruby-identifier">:Root</span>])
75:       <span class="ruby-keyword kw">end</span>
76:       
77:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span> = <span class="ruby-keyword kw">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cat</span>
78:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000507" class="method-detail">
        <a name="M000507"></a>

        <div class="method-heading">
          <a href="#M000507" class="method-signature">
          <span class="method-name">add_fields</span><span class="method-args">(*fields)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a field to the Acrobat form.
</p>
<table>
<tr><td valign="top"><em>field</em>:</td><td>The <a href="Field.html">Field</a> to add.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000507-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000507-source">
<pre>
    <span class="ruby-comment cmt"># File origami/acroform.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_fields</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
52:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected Field arguments&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Field</span>) }
53:       
54:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">InteractiveForm</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
55:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-constant">Fields</span> <span class="ruby-operator">||=</span> []
56:       
57:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-constant">Fields</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">fields</span>)
58:       <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">end</span>
59:       
60:       <span class="ruby-keyword kw">self</span>
61:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000544" class="method-detail">
        <a name="M000544"></a>

        <div class="method-heading">
          <a href="#M000544" class="method-signature">
          <span class="method-name">add_new_revision</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Ends the current <a href="PDF/Revision.html">Revision</a>, and starts a <a
href="PDF.html#M000524">new</a> one.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000544-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000544-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 771</span>
771:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_new_revision</span>
772:       
773:       <span class="ruby-identifier">root</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>[<span class="ruby-identifier">:Root</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">empty?</span>
774: 
775:       <span class="ruby-ivar">@revisions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Revision</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
776:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span> = <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
777:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span> = <span class="ruby-identifier">root</span>
778: 
779:       <span class="ruby-keyword kw">self</span>
780:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000539" class="method-detail">
        <a name="M000539"></a>

        <div class="method-heading">
          <a href="#M000539" class="method-signature">
          <span class="method-name">add_to_revision</span><span class="method-args">(object, revision)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a <a href="PDF.html#M000524">new</a> object to a specific revision. If
this object has no version number, then a <a
href="PDF.html#M000524">new</a> one will be automatically computed and
assignated to him. It returns a Reference to this <a
href="Object.html">Object</a>.
</p>
<table>
<tr><td valign="top"><em>object</em>:</td><td>The object to add.

</td></tr>
<tr><td valign="top"><em>revision</em>:</td><td>The revision to add the object to.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000539-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000539-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 496</span>
496:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">revision</span>)
497:      
498:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
499:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">set_pdf</span>(<span class="ruby-keyword kw">self</span>)
500:       
501:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">object</span>.<span class="ruby-identifier">generation</span> = <span class="ruby-identifier">alloc_new_object_number</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">no</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
502:       
503:       <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>[<span class="ruby-identifier">object</span>.<span class="ruby-identifier">reference</span>] = <span class="ruby-identifier">object</span>
504:       
505:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">reference</span>
506:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000540" class="method-detail">
        <a name="M000540"></a>

        <div class="method-heading">
          <a href="#M000540" class="method-signature">
          <span class="method-name">alloc_new_object_number</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="PDF.html#M000524">new</a> number/generation for future
object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000540-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000540-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 511</span>
511:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">alloc_new_object_number</span>
512:       <span class="ruby-identifier">no</span> = <span class="ruby-value">1</span>
513: 
514:       <span class="ruby-comment cmt"># Deprecated number allocation policy (first available)</span>
515:       <span class="ruby-comment cmt">#no = no + 1 while get_object(no)</span>
516: 
517:       <span class="ruby-identifier">objset</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span>
518:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span>.<span class="ruby-identifier">find_all</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)}.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">objstm</span><span class="ruby-operator">|</span>
519:         <span class="ruby-identifier">objstm</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>}
520:       <span class="ruby-keyword kw">end</span>
521: 
522:       <span class="ruby-identifier">allocated</span> = <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>}.<span class="ruby-identifier">compact</span>
523:       <span class="ruby-identifier">no</span> = <span class="ruby-identifier">allocated</span>.<span class="ruby-identifier">max</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">allocated</span>.<span class="ruby-identifier">empty?</span>
524: 
525:       [ <span class="ruby-identifier">no</span>, <span class="ruby-value">0</span> ]
526:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000560" class="method-detail">
        <a name="M000560"></a>

        <div class="method-heading">
          <a href="#M000560" class="method-signature">
          <span class="method-name">append_page</span><span class="method-args">(page = Page.new, *more)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000560-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000560-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 26</span>
26:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_page</span>(<span class="ruby-identifier">page</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">new</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">more</span>)
27:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Invalid page tree&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">PageTreeNode</span>)
28:       <span class="ruby-identifier">pages</span> = [ <span class="ruby-identifier">page</span> ].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">more</span>)
29:       
30:       <span class="ruby-identifier">treeroot</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>
31:       
32:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Kids</span> <span class="ruby-operator">||=</span> [] <span class="ruby-comment cmt">#:nodoc:</span>
33:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Kids</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">pages</span>)
34:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Count</span> = <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Kids</span>.<span class="ruby-identifier">length</span>
35:       
36:       <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> 
37:         <span class="ruby-identifier">page</span>.<span class="ruby-constant">Parent</span> = <span class="ruby-identifier">treeroot</span>
38:       <span class="ruby-keyword kw">end</span>
39:       
40:       <span class="ruby-keyword kw">self</span>
41:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000534" class="method-detail">
        <a name="M000534"></a>

        <div class="method-heading">
          <a href="#M000534" class="method-signature">
          <span class="method-name">append_subobj</span><span class="method-args">(root, objset, opts)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000534-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000534-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 432</span>
432:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>)
433:         
434:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">o</span>) }.<span class="ruby-identifier">nil?</span>
435:           <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">root</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:only_keys</span>]
436: 
437:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
438:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
439:               <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:only_keys</span>]
440: 
441:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:include_keys</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:only_keys</span>]
442:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>)
443:             }
444:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:include_objectstreams</span>])
445:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>) }
446:           <span class="ruby-keyword kw">end</span>
447:         <span class="ruby-keyword kw">end</span>
448:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000502" class="method-detail">
        <a name="M000502"></a>

        <div class="method-heading">
          <a href="#M000502" class="method-signature">
          <span class="method-name">attach_file</span><span class="method-args">(path, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Attachs an embedded file to the <a href="PDF.html">PDF</a>.
</p>
<table>
<tr><td valign="top"><em>path</em>:</td><td>The path to the file to attach.

</td></tr>
<tr><td valign="top"><em>options</em>:</td><td>A set of options to configure the attachment.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000502-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000502-source">
<pre>
    <span class="ruby-comment cmt"># File origami/file.rb, line 35</span>
35:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attach_file</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = {})
36: 
37:       <span class="ruby-comment cmt">#</span>
38:       <span class="ruby-comment cmt"># Default options.</span>
39:       <span class="ruby-comment cmt">#</span>
40:       <span class="ruby-identifier">params</span> = 
41:       {
42:         <span class="ruby-identifier">:Register</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,                      <span class="ruby-comment cmt"># Shall the file be registered in the name directory ?</span>
43:         <span class="ruby-identifier">:EmbeddedName</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,                   <span class="ruby-comment cmt"># The inner filename of the attachment.</span>
44:         <span class="ruby-identifier">:Filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:FlateDecode</span>                 <span class="ruby-comment cmt"># The stream filter used to store data.</span>
45:       }.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
46: 
47:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:read</span>)
48:         <span class="ruby-identifier">fd</span> = <span class="ruby-identifier">path</span>
49:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:EmbeddedName</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">''</span>
50:       <span class="ruby-keyword kw">else</span>
51:         <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-value str">'r'</span>).<span class="ruby-identifier">binmode</span>
52:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:EmbeddedName</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">path</span>)
53:       <span class="ruby-keyword kw">end</span>
54:       
55:       <span class="ruby-identifier">fstream</span> = <span class="ruby-constant">EmbeddedFileStream</span>.<span class="ruby-identifier">new</span>
56:       <span class="ruby-identifier">fstream</span>.<span class="ruby-identifier">data</span> = <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">read</span>
57:       <span class="ruby-identifier">fstream</span>.<span class="ruby-identifier">setFilter</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:Filter</span>])
58:       
59:       <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:EmbeddedName</span>]
60:       <span class="ruby-identifier">fspec</span> = <span class="ruby-constant">FileSpec</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">setType</span>(<span class="ruby-identifier">:Filespec</span>).<span class="ruby-identifier">setF</span>(<span class="ruby-identifier">name</span>.<span class="ruby-identifier">dup</span>).<span class="ruby-identifier">setEF</span>(
61:         <span class="ruby-constant">FileSpec</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:F</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fstream</span>)
62:       )
63:       
64:       <span class="ruby-identifier">register</span>(
65:         <span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">EMBEDDEDFILES</span>, 
66:         <span class="ruby-identifier">name</span>.<span class="ruby-identifier">dup</span>, 
67:         <span class="ruby-identifier">fspec</span>
68:       ) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:Register</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
69:       
70:       <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span>
71: 
72:       <span class="ruby-identifier">fspec</span>
73:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000541" class="method-detail">
        <a name="M000541"></a>

        <div class="method-heading">
          <a href="#M000541" class="method-signature">
          <span class="method-name">compile</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is meant to recompute, verify and correct main <a
href="PDF.html">PDF</a> structures, in order to output a proper file.
</p>
<ul>
<li>Allocates <a href="PDF.html#M000533">objects</a> references.

</li>
<li>Sets some <a href="PDF.html#M000533">objects</a> missing required values.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000541-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000541-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 533</span>
533:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile</span>(<span class="ruby-identifier">options</span> = {})
534: 
535:       <span class="ruby-comment cmt">#</span>
536:       <span class="ruby-comment cmt"># A valid document must have at least one page.</span>
537:       <span class="ruby-comment cmt">#</span>
538:       <span class="ruby-identifier">append_page</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">empty?</span>
539:      
540:       <span class="ruby-comment cmt">#</span>
541:       <span class="ruby-comment cmt"># Allocates object numbers and creates references.</span>
542:       <span class="ruby-comment cmt"># Invokes object finalization methods.</span>
543:       <span class="ruby-comment cmt">#</span>
544:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedDocument</span>)
545:         <span class="ruby-identifier">physicalize</span>(<span class="ruby-identifier">options</span>)
546:       <span class="ruby-keyword kw">else</span>
547:         <span class="ruby-identifier">physicalize</span>
548:       <span class="ruby-keyword kw">end</span>
549:             
550:       <span class="ruby-comment cmt">#</span>
551:       <span class="ruby-comment cmt"># Sets the PDF version header.</span>
552:       <span class="ruby-comment cmt">#</span>
553:       <span class="ruby-identifier">version</span>, <span class="ruby-identifier">level</span> = <span class="ruby-identifier">version_required</span>
554:       <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">majorversion</span> = <span class="ruby-identifier">version</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
555:       <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">minorversion</span> = <span class="ruby-identifier">version</span>[<span class="ruby-value">2</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
556: 
557:       <span class="ruby-identifier">set_extension_level</span>(<span class="ruby-identifier">version</span>, <span class="ruby-identifier">level</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">level</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
558:       
559:       <span class="ruby-keyword kw">self</span>
560:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000506" class="method-detail">
        <a name="M000506"></a>

        <div class="method-heading">
          <a href="#M000506" class="method-signature">
          <span class="method-name">create_acroform</span><span class="method-args">(*fields)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="PDF.html#M000524">new</a> AcroForm with specified <a
href="PDF.html#M000508">fields</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000506-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000506-source">
<pre>
    <span class="ruby-comment cmt"># File origami/acroform.rb, line 40</span>
40:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_acroform</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
41:       <span class="ruby-identifier">acroform</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">InteractiveForm</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
42:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_fields</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
43: 
44:       <span class="ruby-identifier">acroform</span>
45:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000514" class="method-detail">
        <a name="M000514"></a>

        <div class="method-heading">
          <a href="#M000514" class="method-signature">
          <span class="method-name">create_xfa_form</span><span class="method-args">(xdp, *fields)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000514-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000514-source">
<pre>
    <span class="ruby-comment cmt"># File origami/xfa.rb, line 32</span>
32:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_xfa_form</span>(<span class="ruby-identifier">xdp</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
33:       <span class="ruby-identifier">acroform</span> = <span class="ruby-identifier">create_acroform</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
34:       <span class="ruby-identifier">acroform</span>.<span class="ruby-constant">XFA</span> = <span class="ruby-constant">Stream</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">xdp</span>, <span class="ruby-identifier">:Filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:FlateDecode</span>)
35: 
36:       <span class="ruby-identifier">acroform</span>
37:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000512" class="method-detail">
        <a name="M000512"></a>

        <div class="method-heading">
          <a href="#M000512" class="method-signature">
          <span class="method-name">decrypt</span><span class="method-args">(passwd = &quot;&quot;)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Decrypts the current document (only RC4 40..128 bits). TODO: AESv3
</p>
<table>
<tr><td valign="top"><em>passwd</em>:</td><td>The password to <a href="PDF.html#M000512">decrypt</a> the document.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000512-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000512-source">
<pre>
     <span class="ruby-comment cmt"># File origami/encryption.rb, line 55</span>
 55:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decrypt</span>(<span class="ruby-identifier">passwd</span> = <span class="ruby-value str">&quot;&quot;</span>)
 56:     
 57:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_encrypted?</span>
 58:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;PDF is not encrypted&quot;</span>
 59:       <span class="ruby-keyword kw">end</span>
 60:      
 61:       <span class="ruby-identifier">encrypt_dict</span> = <span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:Encrypt</span>)
 62:       <span class="ruby-identifier">handler</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Standard</span><span class="ruby-operator">::</span><span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">encrypt_dict</span>.<span class="ruby-identifier">copy</span>)
 63: 
 64:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">Filter</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:Standard</span>
 65:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Unknown security handler : '#{handler.Filter.to_s}'&quot;</span>
 66:       <span class="ruby-keyword kw">end</span>
 67: 
 68:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span>.<span class="ruby-identifier">to_i</span>
 69:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span>,<span class="ruby-value">2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">stm_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
 70:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">4</span>,<span class="ruby-value">5</span>
 71:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:CF</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 72:             <span class="ruby-identifier">cfs</span> = <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:CF</span>]
 73:             
 74:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StrF</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Name</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StrF</span>]].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 75:               <span class="ruby-identifier">cfdict</span> = <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StrF</span>]]
 76:               
 77:               <span class="ruby-identifier">str_algo</span> =
 78:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:V2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
 79:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:AESV2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
 80:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:None</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 81:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:AESV3</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
 82:                 <span class="ruby-keyword kw">else</span>
 83:                   <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Unsupported encryption version : #{handler.V}&quot;</span>
 84:                 <span class="ruby-keyword kw">end</span>
 85:             <span class="ruby-keyword kw">else</span>
 86:               <span class="ruby-identifier">str_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 87:             <span class="ruby-keyword kw">end</span>
 88: 
 89:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StmF</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Name</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StmF</span>]].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 90:               <span class="ruby-identifier">cfdict</span> = <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StmF</span>]]
 91: 
 92:               <span class="ruby-identifier">stm_algo</span> =
 93:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:V2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
 94:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:AESV2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
 95:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:None</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 96:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:AESV3</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
 97:                 <span class="ruby-keyword kw">else</span>
 98:                   <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Unsupported encryption version : #{handler.V}&quot;</span>
 99:                 <span class="ruby-keyword kw">end</span>
100:             <span class="ruby-keyword kw">else</span>
101:               <span class="ruby-identifier">stm_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
102:             <span class="ruby-keyword kw">end</span>
103: 
104:           <span class="ruby-keyword kw">else</span>
105:             <span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">stm_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
106:           <span class="ruby-keyword kw">end</span>
107: 
108:         <span class="ruby-keyword kw">else</span>
109:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Unsupported encryption version : #{handler.V}&quot;</span>
110:       <span class="ruby-keyword kw">end</span>
111:       
112:       <span class="ruby-identifier">doc_id</span> = <span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:ID</span>)
113:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">doc_id</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
114:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;Document ID was not found or is invalid&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
115:       <span class="ruby-keyword kw">else</span>
116:         <span class="ruby-identifier">doc_id</span> = <span class="ruby-identifier">doc_id</span>.<span class="ruby-identifier">first</span>
117:       <span class="ruby-keyword kw">end</span>
118: 
119:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">is_owner_password?</span>(<span class="ruby-identifier">passwd</span>, <span class="ruby-identifier">doc_id</span>)
120:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">5</span>
121:           <span class="ruby-identifier">user_passwd</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">retrieve_user_password</span>(<span class="ruby-identifier">passwd</span>)
122:           <span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">compute_user_encryption_key</span>(<span class="ruby-identifier">user_passwd</span>, <span class="ruby-identifier">doc_id</span>)
123:         <span class="ruby-keyword kw">else</span>
124:           <span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">compute_owner_encryption_key</span>(<span class="ruby-identifier">passwd</span>)
125:         <span class="ruby-keyword kw">end</span>
126:       
127:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">is_user_password?</span>(<span class="ruby-identifier">passwd</span>, <span class="ruby-identifier">doc_id</span>)
128:         <span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">compute_user_encryption_key</span>(<span class="ruby-identifier">passwd</span>, <span class="ruby-identifier">doc_id</span>)
129:       <span class="ruby-keyword kw">else</span>
130:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionInvalidPasswordError</span>
131:       <span class="ruby-keyword kw">end</span>
132: 
133: 
134:       <span class="ruby-comment cmt">#self.extend(Encryption::EncryptedDocument)</span>
135:       <span class="ruby-comment cmt">#self.encryption_dict = encrypt_dict</span>
136:       <span class="ruby-comment cmt">#self.encryption_key = encryption_key</span>
137:       <span class="ruby-comment cmt">#self.stm_algo = self.str_algo = algorithm</span>
138: 
139:       <span class="ruby-identifier">encrypt_metadata</span> = (<span class="ruby-identifier">handler</span>.<span class="ruby-constant">EncryptMetadata</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>)
140: 
141:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedDocument</span>)
142:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">encryption_dict</span> = <span class="ruby-identifier">handler</span>
143:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">encryption_key</span>
144:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stm_algo</span>,<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">stm_algo</span>,<span class="ruby-identifier">str_algo</span>
145:       
146:       <span class="ruby-comment cmt">#</span>
147:       <span class="ruby-comment cmt"># Should be fixed to exclude only the active XRefStream</span>
148:       <span class="ruby-comment cmt">#</span>
149:       <span class="ruby-identifier">metadata</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Metadata</span>
150: 
151:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">indobj</span><span class="ruby-operator">|</span>
152:         <span class="ruby-identifier">encrypted_objects</span> = []
153:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">indobj</span>
154:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>,<span class="ruby-constant">Stream</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">encrypted_objects</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">indobj</span>
155:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Dictionary</span>,<span class="ruby-constant">Array</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">encrypted_objects</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">indobj</span>.<span class="ruby-identifier">strings_cache</span>
156:         <span class="ruby-keyword kw">end</span>
157: 
158:         <span class="ruby-identifier">encrypted_objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
159: 
160:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">obj</span>
161:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
162:               <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:U</span>]) <span class="ruby-keyword kw">or</span> 
163:                       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:O</span>]) <span class="ruby-keyword kw">or</span>
164:                       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:UE</span>]) <span class="ruby-keyword kw">or</span>
165:                       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:OE</span>]) <span class="ruby-keyword kw">or</span>
166:                       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:Perms</span>]) <span class="ruby-keyword kw">or</span>
167:                       (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">DigitalSignature</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>[<span class="ruby-identifier">:Contents</span>]))
168: 
169:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedString</span>)
170:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">encryption_handler</span> = <span class="ruby-identifier">handler</span>
171:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">encryption_key</span>
172:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">algorithm</span> = <span class="ruby-identifier">stm_algo</span>
173:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">decrypted</span> = <span class="ruby-keyword kw">false</span>
174:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">decrypt!</span>
175: 
176:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Stream</span>
177:               <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">encrypt_metadata</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">metadata</span>))
178:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedStream</span>)
179:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">encryption_handler</span> = <span class="ruby-identifier">handler</span>
180:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">encryption_key</span>
181:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">algorithm</span> = <span class="ruby-identifier">stm_algo</span>
182:               <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">decrypted</span> = <span class="ruby-keyword kw">false</span>
183:           <span class="ruby-keyword kw">end</span>
184:         <span class="ruby-keyword kw">end</span>
185:       <span class="ruby-keyword kw">end</span>
186: 
187:       <span class="ruby-keyword kw">self</span>
188:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000546" class="method-detail">
        <a name="M000546"></a>

        <div class="method-heading">
          <a href="#M000546" class="method-signature">
          <span class="method-name">delete_object</span><span class="method-args">(no, generation = 0)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove an object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000546-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000546-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 809</span>
809:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">no</span>, <span class="ruby-identifier">generation</span> = <span class="ruby-value">0</span>)
810:       
811:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">no</span>
812:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Reference</span>
813:           <span class="ruby-identifier">target</span> = <span class="ruby-identifier">no</span>
814:         <span class="ruby-keyword kw">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Integer</span>
815:           <span class="ruby-identifier">target</span> = <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">no</span>, <span class="ruby-identifier">generation</span>)
816:       <span class="ruby-keyword kw">else</span>
817:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;Invalid parameter type : #{no.class}&quot;</span> 
818:       <span class="ruby-keyword kw">end</span>
819:       
820:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rev</span><span class="ruby-operator">|</span>
821:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">target</span>)
822:       <span class="ruby-keyword kw">end</span>
823: 
824:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000570" class="method-detail">
        <a name="M000570"></a>

        <div class="method-heading">
          <a href="#M000570" class="method-signature">
          <span class="method-name">delete_xrefstm</span><span class="method-args">(xrefstm)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000570-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000570-source">
<pre>
    <span class="ruby-comment cmt"># File origami/xreftable.rb, line 30</span>
30:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">xrefstm</span>)
31:         <span class="ruby-identifier">prev</span> = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Prev</span>
32:         <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">reference</span>)
33: 
34:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">prev_stm</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">prev</span>)).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>)
35:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">prev_stm</span>)
36:         <span class="ruby-keyword kw">end</span>
37:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000572" class="method-detail">
        <a name="M000572"></a>

        <div class="method-heading">
          <a href="#M000572" class="method-signature">
          <span class="method-name">delinearize!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to delinearize the document if it has been linearized. This operation
is xrefs destructive, should be fixed in the future to merge tables.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000572-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000572-source">
<pre>
    <span class="ruby-comment cmt"># File origami/linearization.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delinearize!</span>
48:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">RuntimeError</span>, <span class="ruby-value str">'Not a linearized document'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_linearized?</span>
49:       
50:       <span class="ruby-comment cmt">#</span>
51:       <span class="ruby-comment cmt"># Saves the first trailer.</span>
52:       <span class="ruby-comment cmt">#</span>
53:       <span class="ruby-identifier">prev_trailer</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">trailer</span>
54: 
55:       <span class="ruby-identifier">lin_dict</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">objects</span>.<span class="ruby-identifier">first</span>
56:       <span class="ruby-identifier">hints</span> = <span class="ruby-identifier">lin_dict</span>[<span class="ruby-identifier">:H</span>]
57:   
58:       <span class="ruby-comment cmt">#</span>
59:       <span class="ruby-comment cmt"># Removes hint streams used by linearization.</span>
60:       <span class="ruby-comment cmt">#</span>
61:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hints</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
62:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hints</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">hints</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
63:           <span class="ruby-identifier">hint_stream</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">hints</span>[<span class="ruby-value">0</span>])
64:           <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">hint_stream</span>.<span class="ruby-identifier">reference</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hint_stream</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
65:         <span class="ruby-keyword kw">end</span>
66: 
67:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hints</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">hints</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
68:           <span class="ruby-identifier">overflow_stream</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">hints</span>[<span class="ruby-value">2</span>])
69:           <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">overflow_stream</span>.<span class="ruby-identifier">reference</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">overflow_stream</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
70:         <span class="ruby-keyword kw">end</span>
71:       <span class="ruby-keyword kw">end</span>
72: 
73:       <span class="ruby-comment cmt">#</span>
74:       <span class="ruby-comment cmt"># Remove all xrefs.</span>
75:       <span class="ruby-comment cmt"># Fix: Should be merged instead.</span>
76:       <span class="ruby-comment cmt">#</span>
77:       <span class="ruby-identifier">remove_xrefs</span>
78: 
79:       <span class="ruby-comment cmt">#</span>
80:       <span class="ruby-comment cmt"># Remove the linearization revision.</span>
81:       <span class="ruby-comment cmt">#</span>
82:       <span class="ruby-identifier">remove_revision</span>(<span class="ruby-value">0</span>)
83: 
84:       <span class="ruby-comment cmt">#</span>
85:       <span class="ruby-comment cmt"># Update the trailer.</span>
86:       <span class="ruby-comment cmt">#</span>
87:       <span class="ruby-identifier">last_trailer</span> = (<span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>)
88: 
89:       <span class="ruby-identifier">last_trailer</span>.<span class="ruby-identifier">dictionary</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>
90:       <span class="ruby-identifier">last_trailer</span>.<span class="ruby-identifier">dictionary</span> =
91:         <span class="ruby-identifier">last_trailer</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">prev_trailer</span>.<span class="ruby-identifier">dictionary</span>)
92: 
93:       <span class="ruby-keyword kw">self</span>
94:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000509" class="method-detail">
        <a name="M000509"></a>

        <div class="method-heading">
          <a href="#M000509" class="method-signature">
          <span class="method-name">each_field</span><span class="method-args">(&amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Iterates over each Acroform <a href="Field.html">Field</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000509-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000509-source">
<pre>
    <span class="ruby-comment cmt"># File origami/acroform.rb, line 77</span>
77:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_field</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
78:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_form?</span>
79:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:Fields</span>)
80:           <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>[<span class="ruby-identifier">:Fields</span>].<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">solve</span>)}
81:         <span class="ruby-keyword kw">end</span>
82:       <span class="ruby-keyword kw">end</span>
83:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000557" class="method-detail">
        <a name="M000557"></a>

        <div class="method-heading">
          <a href="#M000557" class="method-signature">
          <span class="method-name">each_name</span><span class="method-args">(root, &amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000557-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000557-source">
<pre>
     <span class="ruby-comment cmt"># File origami/catalog.rb, line 159</span>
159:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_name</span>(<span class="ruby-identifier">root</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
160:       <span class="ruby-identifier">namesroot</span> = <span class="ruby-identifier">get_names_root</span>(<span class="ruby-identifier">root</span>)
161:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namesroot</span>.<span class="ruby-identifier">nil?</span>
162:    
163:       <span class="ruby-identifier">each_name_from_node</span>(<span class="ruby-identifier">namesroot</span>, [], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
164:       <span class="ruby-keyword kw">self</span>
165:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000549" class="method-detail">
        <a name="M000549"></a>

        <div class="method-heading">
          <a href="#M000549" class="method-signature">
          <span class="method-name">each_named_dest</span><span class="method-args">(&amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls block for each named destination.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000549-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000549-source">
<pre>
    <span class="ruby-comment cmt"># File origami/destinations.rb, line 40</span>
40:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_named_dest</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
41:       <span class="ruby-identifier">each_name</span>(<span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">DESTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>) 
42:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000504" class="method-detail">
        <a name="M000504"></a>

        <div class="method-heading">
          <a href="#M000504" class="method-signature">
          <span class="method-name">each_named_embedded_file</span><span class="method-args">(&amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls block for each named embedded file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000504-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000504-source">
<pre>
    <span class="ruby-comment cmt"># File origami/file.rb, line 85</span>
85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_named_embedded_file</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
86:       <span class="ruby-identifier">each_name</span>(<span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">EMBEDDEDFILES</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>) 
87:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000566" class="method-detail">
        <a name="M000566"></a>

        <div class="method-heading">
          <a href="#M000566" class="method-signature">
          <span class="method-name">each_named_page</span><span class="method-args">(&amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls block for each named page.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000566-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000566-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 88</span>
88:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_named_page</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
89:       <span class="ruby-identifier">each_name</span>(<span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">PAGES</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>) 
90:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000520" class="method-detail">
        <a name="M000520"></a>

        <div class="method-heading">
          <a href="#M000520" class="method-signature">
          <span class="method-name">each_named_script</span><span class="method-args">(&amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls block for each named JavaScript script.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000520-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000520-source">
<pre>
    <span class="ruby-comment cmt"># File origami/actions.rb, line 40</span>
40:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_named_script</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
41:       <span class="ruby-identifier">each_name</span>(<span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">JAVASCRIPT</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>) 
42:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000563" class="method-detail">
        <a name="M000563"></a>

        <div class="method-heading">
          <a href="#M000563" class="method-signature">
          <span class="method-name">each_page</span><span class="method-args">(&amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Iterate through each page, returns self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000563-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000563-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 62</span>
62:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_page</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
63:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Invalid page tree&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">PageTreeNode</span>)
64:      
65:        <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">each_page</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
66:        <span class="ruby-keyword kw">self</span>
67:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000575" class="method-detail">
        <a name="M000575"></a>

        <div class="method-heading">
          <a href="#M000575" class="method-signature">
          <span class="method-name">enable_usage_rights</span><span class="method-args">(cert, pkey, *rights)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Enable the document Usage Rights.
</p>
<table>
<tr><td valign="top"><em>rights</em>:</td><td>list of rights defined in <a
href="UsageRights/Rights.html">UsageRights::Rights</a>

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000575-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000575-source">
<pre>
     <span class="ruby-comment cmt"># File origami/signature.rb, line 130</span>
130:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">enable_usage_rights</span>(<span class="ruby-identifier">cert</span>, <span class="ruby-identifier">pkey</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rights</span>)
131:       
132:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span> = []) <span class="ruby-comment cmt">#:nodoc:</span>
133:         <span class="ruby-identifier">datatest</span> = <span class="ruby-value str">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
134:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">datatest</span>, <span class="ruby-identifier">ca</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">128</span>
135:       <span class="ruby-keyword kw">end</span>
136:       
137:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Origami</span><span class="ruby-operator">::</span><span class="ruby-constant">OPTIONS</span>[<span class="ruby-identifier">:use_openssl</span>]
138:         <span class="ruby-identifier">fail</span> <span class="ruby-value str">&quot;OpenSSL is not present or has been disabled.&quot;</span>
139:       <span class="ruby-keyword kw">end</span>
140:       
141:       <span class="ruby-comment cmt">#</span>
142:       <span class="ruby-comment cmt"># Load key pair</span>
143:       <span class="ruby-comment cmt">#</span>
144:       <span class="ruby-identifier">key</span> = <span class="ruby-identifier">pkey</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">pkey</span> <span class="ruby-operator">:</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pkey</span>)
145:       <span class="ruby-identifier">certificate</span> = <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">cert</span> <span class="ruby-operator">:</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cert</span>)
146:       
147:       <span class="ruby-comment cmt">#</span>
148:       <span class="ruby-comment cmt"># Forge digital signature dictionary</span>
149:       <span class="ruby-comment cmt">#</span>
150:       <span class="ruby-identifier">digsig</span> = <span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">DigitalSignature</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
151:       
152:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">InteractiveForm</span>.<span class="ruby-identifier">new</span>
153:       <span class="ruby-comment cmt">#self.Catalog.AcroForm.SigFlags = InteractiveForm::SigFlags::APPENDONLY</span>
154:       
155:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:Sig</span> <span class="ruby-comment cmt">#:nodoc:</span>
156:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;\x00&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, [])) <span class="ruby-comment cmt">#:nodoc:</span>
157:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Filter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Adobe.PPKLite&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
158:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Name</span> = <span class="ruby-value str">&quot;ARE Acrobat Product v8.0 P23 0002337&quot;</span> <span class="ruby-comment cmt">#:nodoc:</span>
159:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">SubFilter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;adbe.pkcs7.detached&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
160:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span> = [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-comment cmt">#:nodoc:</span>
161:       
162:       <span class="ruby-identifier">sigref</span> = <span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment cmt">#:nodoc:</span>
163:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:SigRef</span> <span class="ruby-comment cmt">#:nodoc:</span>
164:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformMethod</span> = <span class="ruby-identifier">:UR3</span> <span class="ruby-comment cmt">#:nodoc:</span>
165:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">Data</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
166:       
167:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span> = <span class="ruby-constant">UsageRights</span><span class="ruby-operator">::</span><span class="ruby-constant">TransformParams</span>.<span class="ruby-identifier">new</span>
168:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>.<span class="ruby-constant">P</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-comment cmt">#:nodoc:</span>
169:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:TransformParams</span> <span class="ruby-comment cmt">#:nodoc:</span>
170:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>.<span class="ruby-constant">V</span> = <span class="ruby-constant">UsageRights</span><span class="ruby-operator">::</span><span class="ruby-constant">TransformParams</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>
171:       
172:       <span class="ruby-identifier">rights</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">right</span><span class="ruby-operator">|</span>
173:         <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>[<span class="ruby-identifier">right</span>.<span class="ruby-identifier">first</span>] <span class="ruby-operator">||=</span> []
174:         <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>[<span class="ruby-identifier">right</span>.<span class="ruby-identifier">first</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">right</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
175:       <span class="ruby-keyword kw">end</span>
176:       
177:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Reference</span> = [ <span class="ruby-identifier">sigref</span> ]
178:       
179:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Perms</span>.<span class="ruby-identifier">new</span>
180:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span>.<span class="ruby-constant">UR3</span> = <span class="ruby-identifier">digsig</span>
181:       
182:       <span class="ruby-comment cmt">#</span>
183:       <span class="ruby-comment cmt">#  Flattening the PDF to get file view.</span>
184:       <span class="ruby-comment cmt">#</span>
185:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span>
186:       
187:       <span class="ruby-comment cmt">#</span>
188:       <span class="ruby-comment cmt"># Creating an empty Xref table to compute signature byte range.</span>
189:       <span class="ruby-comment cmt">#</span>
190:       <span class="ruby-identifier">rebuild_dummy_xrefs</span>
191:       
192:       <span class="ruby-identifier">sigoffset</span> = <span class="ruby-identifier">get_object_offset</span>(<span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">generation</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">sigOffset</span>
193:       
194:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>] = <span class="ruby-value">0</span> 
195:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">sigoffset</span>
196:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">sigoffset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>.<span class="ruby-identifier">size</span>
197:       
198:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] = <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>]
199:       
200:       <span class="ruby-comment cmt"># From that point the file size remains constant</span>
201:       
202:       <span class="ruby-comment cmt">#</span>
203:       <span class="ruby-comment cmt"># Correct Xrefs variations caused by ByteRange modifications.</span>
204:       <span class="ruby-comment cmt">#</span>
205:       <span class="ruby-identifier">rebuildxrefs</span>
206:       
207:       <span class="ruby-identifier">filedata</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>
208:       <span class="ruby-identifier">signable_data</span> = <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>]] <span class="ruby-operator">+</span> <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>]]
209:       
210:       <span class="ruby-identifier">signature</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">signable_data</span>, [], <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>
211:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">signature</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">signature</span>
212:       
213:       <span class="ruby-comment cmt">#</span>
214:       <span class="ruby-comment cmt"># No more modification are allowed after signing.</span>
215:       <span class="ruby-comment cmt">#</span>
216:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">freeze</span>
217:       
218:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000513" class="method-detail">
        <a name="M000513"></a>

        <div class="method-heading">
          <a href="#M000513" class="method-signature">
          <span class="method-name">encrypt</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Encrypts the current document with the provided passwords. The document
will be encrypted at writing-on-disk time.
</p>
<table>
<tr><td valign="top"><em>userpasswd</em>:</td><td>The user password.

</td></tr>
<tr><td valign="top"><em>ownerpasswd</em>:</td><td>The owner password.

</td></tr>
<tr><td valign="top"><em>options</em>:</td><td>A set of options to configure encryption.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000513-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000513-source">
<pre>
     <span class="ruby-comment cmt"># File origami/encryption.rb, line 197</span>
197:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encrypt</span>(<span class="ruby-identifier">options</span> = {})
198:     
199:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_encrypted?</span>
200:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;PDF is already encrypted&quot;</span>
201:       <span class="ruby-keyword kw">end</span>
202: 
203:       <span class="ruby-comment cmt">#</span>
204:       <span class="ruby-comment cmt"># Default encryption options.</span>
205:       <span class="ruby-comment cmt">#</span>
206:       <span class="ruby-identifier">params</span> = 
207:       {
208:         <span class="ruby-identifier">:user_passwd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>,
209:         <span class="ruby-identifier">:owner_passwd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>,
210:         <span class="ruby-identifier">:cipher</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rc4'</span>,            <span class="ruby-comment cmt"># :RC4 or :AES</span>
211:         <span class="ruby-identifier">:key_size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">128</span>,            <span class="ruby-comment cmt"># Key size in bits</span>
212:         <span class="ruby-identifier">:encrypt_metadata</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,   <span class="ruby-comment cmt"># Metadata shall be encrypted?</span>
213:         <span class="ruby-identifier">:permissions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Standard</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL</span>    <span class="ruby-comment cmt"># Document permissions</span>
214:       }.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
215: 
216:       <span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">ownerpasswd</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user_passwd</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:owner_passwd</span>]
217: 
218:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:cipher</span>].<span class="ruby-identifier">upcase</span>
219:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'RC4'</span>
220:           <span class="ruby-identifier">algorithm</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
221:           <span class="ruby-keyword kw">if</span> (<span class="ruby-value">40</span><span class="ruby-operator">..</span><span class="ruby-value">128</span>) <span class="ruby-operator">===</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>] <span class="ruby-operator">%</span> <span class="ruby-value">8</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
222:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">40</span>
223:               <span class="ruby-identifier">version</span> = <span class="ruby-value">2</span>
224:               <span class="ruby-identifier">revision</span> = <span class="ruby-value">3</span>
225:             <span class="ruby-keyword kw">else</span>
226:               <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>
227:               <span class="ruby-identifier">revision</span> = <span class="ruby-value">2</span>
228:             <span class="ruby-keyword kw">end</span>
229:           <span class="ruby-keyword kw">else</span>
230:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;Invalid RC4 key length&quot;</span>
231:           <span class="ruby-keyword kw">end</span>
232:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'AES'</span>
233:           <span class="ruby-identifier">algorithm</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
234:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>] <span class="ruby-operator">==</span> <span class="ruby-value">128</span> 
235:             <span class="ruby-identifier">version</span> = <span class="ruby-identifier">revision</span> = <span class="ruby-value">4</span>
236:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>] <span class="ruby-operator">==</span> <span class="ruby-value">256</span>
237:             <span class="ruby-identifier">version</span> = <span class="ruby-identifier">revision</span> = <span class="ruby-value">5</span>
238:           <span class="ruby-keyword kw">else</span>
239:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;Invalid AES key length (Only 128 and 256 bits keys are supported)&quot;</span>
240:           <span class="ruby-keyword kw">end</span>
241:         <span class="ruby-keyword kw">else</span>
242:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Cipher not supported : #{params[:cipher]}&quot;</span>
243:       <span class="ruby-keyword kw">end</span>
244:      
245:       <span class="ruby-identifier">doc_id</span> = (<span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:ID</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">gen_id</span>).<span class="ruby-identifier">first</span>
246: 
247:       <span class="ruby-identifier">handler</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Standard</span><span class="ruby-operator">::</span><span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>
248:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">Filter</span> = <span class="ruby-identifier">:Standard</span> <span class="ruby-comment cmt">#:nodoc:</span>
249:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span> = <span class="ruby-identifier">version</span>
250:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">R</span> = <span class="ruby-identifier">revision</span>
251:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">Length</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>]
252:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">P</span> = <span class="ruby-value">-1</span> <span class="ruby-comment cmt"># params[:Permissions] </span>
253:       
254:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">revision</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">4</span>
255:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">EncryptMetadata</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:encrypt_metadata</span>]
256:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">CF</span> = <span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>
257:         <span class="ruby-identifier">cryptfilter</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">CryptFilterDictionary</span>.<span class="ruby-identifier">new</span>
258:         <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">AuthEvent</span> = <span class="ruby-identifier">:DocOpen</span>
259:         
260:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">revision</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
261:           <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">CFM</span> = <span class="ruby-identifier">:AESV2</span>
262:         <span class="ruby-keyword kw">else</span>
263:           <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">CFM</span> = <span class="ruby-identifier">:AESV3</span>
264:         <span class="ruby-keyword kw">end</span>
265: 
266:         <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">Length</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:key_size</span>] <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">3</span>
267: 
268:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">CF</span>[<span class="ruby-identifier">:StdCF</span>] = <span class="ruby-identifier">cryptfilter</span>
269:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">StmF</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-constant">StrF</span> = <span class="ruby-identifier">:StdCF</span>
270:       <span class="ruby-keyword kw">end</span>
271:      
272:       <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">set_passwords</span>(<span class="ruby-identifier">ownerpasswd</span>, <span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">doc_id</span>)
273:       <span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">compute_user_encryption_key</span>(<span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">doc_id</span>)
274: 
275:       <span class="ruby-identifier">fileInfo</span> = <span class="ruby-identifier">get_trailer_info</span>
276:       <span class="ruby-identifier">fileInfo</span>[<span class="ruby-identifier">:Encrypt</span>] = <span class="ruby-keyword kw">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">handler</span>
277: 
278:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedDocument</span>)
279:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">encryption_dict</span> = <span class="ruby-identifier">handler</span>
280:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">encryption_key</span>
281:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stm_algo</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">algorithm</span>
282: 
283:       <span class="ruby-keyword kw">self</span>
284:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000567" class="method-detail">
        <a name="M000567"></a>

        <div class="method-heading">
          <a href="#M000567" class="method-signature">
          <span class="method-name">export_to_graph</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Exports the document to a dot Graphiz file.
</p>
<table>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000527">save</a> the file.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000567-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000567-source">
<pre>
     <span class="ruby-comment cmt"># File origami/export.rb, line 34</span>
 34:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">export_to_graph</span>(<span class="ruby-identifier">filename</span>)
 35:       
 36:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 37:       
 38:         <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
 39:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">object</span>
 40:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Catalog</span>
 41:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
 42:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;mistyrose&quot;</span>
 43:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
 44:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Name</span>, <span class="ruby-constant">Number</span>
 45:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> 
 46:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;brown&quot;</span>
 47:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightgoldenrodyellow&quot;</span>
 48:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
 49:            <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
 50:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_binary_data?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span>)
 51:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
 52:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;white&quot;</span>
 53:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
 54:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
 55:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;darkgreen&quot;</span>
 56:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightcyan&quot;</span>
 57:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
 58:         <span class="ruby-keyword kw">else</span>
 59:           <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;blue&quot;</span>
 60:           <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;aliceblue&quot;</span>
 61:           <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
 62:         <span class="ruby-keyword kw">end</span>
 63:       
 64:         { <span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span>, <span class="ruby-identifier">:fontcolor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fontcolor</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">color</span>, <span class="ruby-identifier">:shape</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">shape</span> }
 65:       <span class="ruby-keyword kw">end</span>
 66:       
 67:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_edges</span>(<span class="ruby-identifier">pdf</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 68:         
 69:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
 70:           
 71:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
 72:             <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) 
 73:             <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} -&gt; #{subobj.object_id}\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
 74:           }
 75:           
 76:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 77:           
 78:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
 79:             <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) 
 80:             <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} -&gt; #{subobj.object_id} [label=\&quot;#{name.value}\&quot;,fontsize=9];\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
 81:           }
 82:           
 83:         <span class="ruby-keyword kw">end</span>
 84:         
 85:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
 86:           
 87:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
 88:             <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
 89:             <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} -&gt; #{value.object_id} [label=\&quot;#{key.value}\&quot;,fontsize=9];\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
 90:           }
 91:           
 92:         <span class="ruby-keyword kw">end</span>
 93:         
 94:       <span class="ruby-keyword kw">end</span>
 95:       
 96:       <span class="ruby-identifier">graphname</span> = <span class="ruby-value str">&quot;PDF&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">empty?</span>
 97:       <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">&quot;w&quot;</span>)
 98:     
 99:       <span class="ruby-keyword kw">begin</span>
100:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;digraph #{graphname} {\n\n&quot;</span>
101:         
102:         <span class="ruby-identifier">objects</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>(<span class="ruby-identifier">:include_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">find_all</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) }
103:         
104:         <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
105:           <span class="ruby-identifier">attr</span> = <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>)
106:           
107:           <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} [label=\&quot;#{attr[:label]}\&quot;,shape=#{attr[:shape]},color=#{attr[:color]},style=filled,fontcolor=#{attr[:fontcolor]},fontsize=16];\n&quot;</span>
108:           
109:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
110:             
111:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
112:               <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
113:                 <span class="ruby-identifier">attr</span> = <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">value</span>)
114:                 <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{value.object_id} [label=\&quot;#{attr[:label]}\&quot;,shape=#{attr[:shape]},color=#{attr[:color]},style=filled,fontcolor=#{attr[:fontcolor]},fontsize=16];\n&quot;</span>
115:               <span class="ruby-keyword kw">end</span>
116:             }
117:             
118:           <span class="ruby-keyword kw">end</span>
119:           
120:           <span class="ruby-identifier">add_edges</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>)
121:         }
122:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n}&quot;</span>
123:       <span class="ruby-keyword kw">ensure</span>
124:         <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span>
125:       <span class="ruby-keyword kw">end</span>
126:       
127:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000568" class="method-detail">
        <a name="M000568"></a>

        <div class="method-heading">
          <a href="#M000568" class="method-signature">
          <span class="method-name">export_to_graphml</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Exports the document to a GraphML file.
</p>
<table>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000527">save</a> the file.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000568-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000568-source">
<pre>
     <span class="ruby-comment cmt"># File origami/export.rb, line 133</span>
133:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">export_to_graphml</span>(<span class="ruby-identifier">filename</span>)
134:       
135:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">declare_node</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">attr</span>) <span class="ruby-comment cmt">#:nodoc:</span>
136:         <span class="ruby-node">&quot; &lt;node id=\&quot;#{id}\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
137:         <span class="ruby-value str">&quot;  &lt;data key=\&quot;d0\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
138:         <span class="ruby-value str">&quot;    &lt;y:ShapeNode&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
139:         <span class="ruby-node">&quot;     &lt;y:NodeLabel&gt;#{attr[:label]}&lt;/y:NodeLabel&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
140:         <span class="ruby-comment cmt">#~ &quot;     &lt;y:Shape type=\&quot;#{attr[:shape]}\&quot;/&gt;\n&quot; &lt;&lt;</span>
141:         <span class="ruby-value str">&quot;    &lt;/y:ShapeNode&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
142:         <span class="ruby-value str">&quot;  &lt;/data&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
143:         <span class="ruby-value str">&quot; &lt;/node&gt;\n&quot;</span>
144:       <span class="ruby-keyword kw">end</span>
145:       
146:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">label</span> = <span class="ruby-keyword kw">nil</span>) <span class="ruby-comment cmt">#:nodoc:</span>
147:         <span class="ruby-node">&quot; &lt;edge id=\&quot;#{id}\&quot; source=\&quot;#{src}\&quot; target=\&quot;#{dest}\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span> 
148:         <span class="ruby-value str">&quot;  &lt;data key=\&quot;d1\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
149:         <span class="ruby-value str">&quot;   &lt;y:PolyLineEdge&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
150:         <span class="ruby-value str">&quot;    &lt;y:LineStyle type=\&quot;line\&quot; width=\&quot;1.0\&quot; color=\&quot;#000000\&quot;/&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
151:         <span class="ruby-value str">&quot;    &lt;y:Arrows source=\&quot;none\&quot; target=\&quot;standard\&quot;/&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span> 
152:         <span class="ruby-node">&quot;    &lt;y:EdgeLabel&gt;#{label.to_s}&lt;/y:EdgeLabel&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
153:         <span class="ruby-value str">&quot;   &lt;/y:PolyLineEdge&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
154:         <span class="ruby-value str">&quot;  &lt;/data&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
155:         <span class="ruby-value str">&quot; &lt;/edge&gt;\n&quot;</span>
156:       <span class="ruby-keyword kw">end</span>
157:       
158:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>) <span class="ruby-comment cmt">#:nodoc:</span>
159:       
160:         <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
161:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">object</span>
162:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Catalog</span>
163:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
164:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;mistyrose&quot;</span>
165:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;doublecircle&quot;</span>
166:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Name</span>, <span class="ruby-constant">Number</span>
167:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> 
168:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;orange&quot;</span>
169:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightgoldenrodyellow&quot;</span>
170:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
171:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
172:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_binary_data?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span>)
173:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
174:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;white&quot;</span>
175:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
176:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
177:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;green&quot;</span>
178:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightcyan&quot;</span>
179:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
180:         <span class="ruby-keyword kw">else</span>
181:           <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;blue&quot;</span>
182:           <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;aliceblue&quot;</span>
183:           <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
184:         <span class="ruby-keyword kw">end</span>
185:       
186:         { <span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span>, <span class="ruby-identifier">:fontcolor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fontcolor</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">color</span>, <span class="ruby-identifier">:shape</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">shape</span> }
187:       <span class="ruby-keyword kw">end</span>
188:       
189:      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_edges</span>(<span class="ruby-identifier">pdf</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">id</span>) <span class="ruby-comment cmt">#:nodoc:</span>
190:         
191:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
192:           
193:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
194:             
195:             <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
196:             
197:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
198:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-node">&quot;e#{id}&quot;</span>, <span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-node">&quot;n#{subobj.object_id}&quot;</span>)
199:               <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
200:             <span class="ruby-keyword kw">end</span>
201:           }
202:           
203:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
204:           
205:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
206:             
207:             <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
208:             
209:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
210:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-node">&quot;e#{id}&quot;</span>, <span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-node">&quot;n#{subobj.object_id}&quot;</span>, <span class="ruby-identifier">name</span>.<span class="ruby-identifier">value</span>)
211:               <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
212:             <span class="ruby-keyword kw">end</span>
213:           }
214:           
215:         <span class="ruby-keyword kw">end</span>
216:         
217:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
218:           
219:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
220:           
221:             <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
222:             
223:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
224:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-node">&quot;e#{id}&quot;</span>, <span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-node">&quot;n#{value.object_id}&quot;</span>, <span class="ruby-identifier">key</span>.<span class="ruby-identifier">value</span>)
225:               <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
226:             <span class="ruby-keyword kw">end</span>
227:           }
228:           
229:         <span class="ruby-keyword kw">end</span>
230:         
231:         <span class="ruby-identifier">id</span>
232:       <span class="ruby-keyword kw">end</span>
233:       
234:       <span class="ruby-ivar">@@edge_nb</span> = <span class="ruby-value">1</span>
235:       
236:       <span class="ruby-identifier">graphname</span> = <span class="ruby-value str">&quot;PDF&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">empty?</span>
237:       
238:       <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">&quot;w&quot;</span>)
239:       
240:       <span class="ruby-identifier">edge_nb</span> = <span class="ruby-value">1</span>
241:       <span class="ruby-keyword kw">begin</span>
242:         
243:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
244:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns/graphml&quot;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
245:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
246:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns/graphml '</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
247:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' http://www.yworks.com/xml/schema/graphml/1.0/ygraphml.xsd&quot;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
248:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' xmlns:y=&quot;http://www.yworks.com/xml/graphml&quot;&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
249:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;key id=&quot;d0&quot; for=&quot;node&quot; yfiles.type=&quot;nodegraphics&quot;/&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
250:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;key id=&quot;d1&quot; for=&quot;edge&quot; yfiles.type=&quot;edgegraphics&quot;/&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
251:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;graph id=\&quot;#{graphname}\&quot; edgedefault=\&quot;directed\&quot;&gt;\n&quot;</span>
252:         
253:         <span class="ruby-identifier">objects</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>(<span class="ruby-identifier">:include_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">find_all</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) }
254:         
255:         <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
256:           
257:           <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_node</span>(<span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>))
258:           
259:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
260:             
261:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
262:             
263:               <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
264:                 <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_node</span>(<span class="ruby-identifier">value</span>.<span class="ruby-identifier">object_id</span>, <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">value</span>))
265:               <span class="ruby-keyword kw">end</span>
266:             }
267:           <span class="ruby-keyword kw">end</span>
268:           
269:           <span class="ruby-identifier">edge_nb</span> = <span class="ruby-identifier">add_edges</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">edge_nb</span>)
270:         }
271:         
272:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/graph&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
273:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/graphml&gt;'</span>
274:         
275:       <span class="ruby-keyword kw">ensure</span>
276:         <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span>
277:       <span class="ruby-keyword kw">end</span>
278:       
279:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000508" class="method-detail">
        <a name="M000508"></a>

        <div class="method-heading">
          <a href="#M000508" class="method-signature">
          <span class="method-name">fields</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of Acroform <a href="PDF.html#M000508">fields</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000508-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000508-source">
<pre>
    <span class="ruby-comment cmt"># File origami/acroform.rb, line 66</span>
66:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fields</span>
67:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_form?</span>
68:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:Fields</span>)
69:           <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>[<span class="ruby-identifier">:Fields</span>].<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">solve</span>}
70:         <span class="ruby-keyword kw">end</span>
71:       <span class="ruby-keyword kw">end</span>
72:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000526" class="method-detail">
        <a name="M000526"></a>

        <div class="method-heading">
          <a href="#M000526" class="method-signature">
          <span class="method-name">filesize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the virtual file size as it would be taking on disk.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000526-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000526-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 236</span>
236:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filesize</span>
237:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>(<span class="ruby-identifier">:rebuildxrefs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">size</span>
238:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000532" class="method-detail">
        <a name="M000532"></a>

        <div class="method-heading">
          <a href="#M000532" class="method-signature">
          <span class="method-name">find</span><span class="method-args">(params = {}, &amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="PDF.html#M000533">objects</a> matching
specified block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000532-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000532-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 411</span>
411:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
412:       
413:       <span class="ruby-identifier">options</span> =
414:       {
415:         <span class="ruby-identifier">:only_indirect</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
416:       }
417:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
418:       
419:       <span class="ruby-identifier">objset</span> = (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:only_indirect</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-operator">?</span> 
420:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>
421: 
422:       <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find_all</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
423:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000548" class="method-detail">
        <a name="M000548"></a>

        <div class="method-heading">
          <a href="#M000548" class="method-signature">
          <span class="method-name">get_destination_by_name</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lookup destination in the destination name directory.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000548-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000548-source">
<pre>
    <span class="ruby-comment cmt"># File origami/destinations.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_destination_by_name</span>(<span class="ruby-identifier">name</span>)
34:       <span class="ruby-identifier">resolve_name</span> <span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">DESTS</span>, <span class="ruby-identifier">name</span>
35:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000517" class="method-detail">
        <a name="M000517"></a>

        <div class="method-heading">
          <a href="#M000517" class="method-signature">
          <span class="method-name">get_document_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the document information dictionary if present.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000517-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000517-source">
<pre>
    <span class="ruby-comment cmt"># File origami/metadata.rb, line 49</span>
49:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_document_info</span>
50:       <span class="ruby-identifier">get_doc_attr</span> <span class="ruby-identifier">:Info</span>
51:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000503" class="method-detail">
        <a name="M000503"></a>

        <div class="method-heading">
          <a href="#M000503" class="method-signature">
          <span class="method-name">get_embedded_file_by_name</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lookup embedded file in the embedded files name directory.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000503-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000503-source">
<pre>
    <span class="ruby-comment cmt"># File origami/file.rb, line 78</span>
78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_embedded_file_by_name</span>(<span class="ruby-identifier">name</span>)
79:       <span class="ruby-identifier">resolve_name</span> <span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">EMBEDDEDFILES</span>, <span class="ruby-identifier">name</span>
80:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000510" class="method-detail">
        <a name="M000510"></a>

        <div class="method-heading">
          <a href="#M000510" class="method-signature">
          <span class="method-name">get_field</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the corresponding named <a href="Field.html">Field</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000510-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000510-source">
<pre>
    <span class="ruby-comment cmt"># File origami/acroform.rb, line 88</span>
88:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_field</span>(<span class="ruby-identifier">name</span>)
89:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">each_field</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
90:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">field</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>[<span class="ruby-identifier">:T</span>].<span class="ruby-identifier">solve</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>
91:       <span class="ruby-keyword kw">end</span>
92:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000518" class="method-detail">
        <a name="M000518"></a>

        <div class="method-heading">
          <a href="#M000518" class="method-signature">
          <span class="method-name">get_metadata</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a Hash of the information found in the metadata stream
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000518-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000518-source">
<pre>
    <span class="ruby-comment cmt"># File origami/metadata.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_metadata</span>
57:       <span class="ruby-identifier">metadata_stm</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Metadata</span>
58: 
59:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">metadata_stm</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
60:         <span class="ruby-identifier">doc</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata_stm</span>.<span class="ruby-identifier">data</span>)
61: 
62:         <span class="ruby-identifier">info</span> = {}
63: 
64:         <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'*/*/rdf:Description'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">description</span><span class="ruby-operator">|</span>
65:           
66:           <span class="ruby-identifier">description</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each_attribute</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span>
67:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">attr</span>.<span class="ruby-identifier">prefix</span>
68:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'pdf'</span>,<span class="ruby-value str">'xap'</span>,<span class="ruby-value str">'pdf'</span>
69:                 <span class="ruby-identifier">info</span>[<span class="ruby-identifier">attr</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">attr</span>.<span class="ruby-identifier">value</span>
70:             <span class="ruby-keyword kw">end</span>
71:           <span class="ruby-keyword kw">end</span>
72: 
73:           <span class="ruby-identifier">description</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'*'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
74:             <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-value str">'.//rdf:li'</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">element</span>).<span class="ruby-identifier">text</span>
75:             <span class="ruby-identifier">info</span>[<span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
76:           <span class="ruby-keyword kw">end</span>
77: 
78:         <span class="ruby-keyword kw">end</span>
79: 
80:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">info</span>
81:       <span class="ruby-keyword kw">end</span>
82:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000564" class="method-detail">
        <a name="M000564"></a>

        <div class="method-heading">
          <a href="#M000564" class="method-signature">
          <span class="method-name">get_page</span><span class="method-args">(n)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the n-th <a href="Page.html">Page</a> object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000564-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000564-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 72</span>
72:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_page</span>(<span class="ruby-identifier">n</span>)
73:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Invalid page tree&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">PageTreeNode</span>)
74: 
75:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">get_page</span>(<span class="ruby-identifier">n</span>)
76:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000565" class="method-detail">
        <a name="M000565"></a>

        <div class="method-heading">
          <a href="#M000565" class="method-signature">
          <span class="method-name">get_page_by_name</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lookup page in the page name directory.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000565-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000565-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 81</span>
81:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_page_by_name</span>(<span class="ruby-identifier">name</span>)
82:       <span class="ruby-identifier">resolve_name</span> <span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">PAGES</span>, <span class="ruby-identifier">name</span>
83:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000519" class="method-detail">
        <a name="M000519"></a>

        <div class="method-heading">
          <a href="#M000519" class="method-signature">
          <span class="method-name">get_script_by_name</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lookup script in the scripts name directory.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000519-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000519-source">
<pre>
    <span class="ruby-comment cmt"># File origami/actions.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_script_by_name</span>(<span class="ruby-identifier">name</span>)
34:       <span class="ruby-identifier">resolve_name</span> <span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">JAVASCRIPT</span>, <span class="ruby-identifier">name</span>
35:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000515" class="method-detail">
        <a name="M000515"></a>

        <div class="method-heading">
          <a href="#M000515" class="method-signature">
          <span class="method-name">has_document_info?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the document has a document information dictionary.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000515-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000515-source">
<pre>
    <span class="ruby-comment cmt"># File origami/metadata.rb, line 35</span>
35:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_document_info?</span>
36:       <span class="ruby-identifier">has_attr?</span> <span class="ruby-identifier">:Info</span> 
37:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000505" class="method-detail">
        <a name="M000505"></a>

        <div class="method-heading">
          <a href="#M000505" class="method-signature">
          <span class="method-name">has_form?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the document contains an acrobat form.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000505-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000505-source">
<pre>
    <span class="ruby-comment cmt"># File origami/acroform.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_form?</span>
34:       (<span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">:AcroForm</span>
35:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000516" class="method-detail">
        <a name="M000516"></a>

        <div class="method-heading">
          <a href="#M000516" class="method-signature">
          <span class="method-name">has_metadata?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the document has a catalog metadata stream.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000516-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000516-source">
<pre>
    <span class="ruby-comment cmt"># File origami/metadata.rb, line 42</span>
42:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_metadata?</span>
43:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">:Metadata</span> 
44:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000576" class="method-detail">
        <a name="M000576"></a>

        <div class="method-heading">
          <a href="#M000576" class="method-signature">
          <span class="method-name">has_usage_rights?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000576-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000576-source">
<pre>
     <span class="ruby-comment cmt"># File origami/signature.rb, line 220</span>
220:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_usage_rights?</span>
221:       <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:UR3</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:UR</span>))
222:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000535" class="method-detail">
        <a name="M000535"></a>

        <div class="method-heading">
          <a href="#M000535" class="method-signature">
          <span class="method-name">indirect_objects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return an array of indirect <a href="PDF.html#M000533">objects</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000535-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000535-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 473</span>
473:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">indirect_objects</span>
474:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set</span>, <span class="ruby-identifier">rev</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">rev</span>.<span class="ruby-identifier">objects</span>) <span class="ruby-keyword kw">end</span>
475:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000538" class="method-detail">
        <a name="M000538"></a>

        <div class="method-heading">
          <span class="method-name">insert</span><span class="method-args">(object)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for #&lt;&lt;
</p>
        </div>
      </div>

      <div id="method-M000561" class="method-detail">
        <a name="M000561"></a>

        <div class="method-heading">
          <a href="#M000561" class="method-signature">
          <span class="method-name">insert_page</span><span class="method-args">(index, page)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000561-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000561-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 43</span>
43:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert_page</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">page</span>)
44:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Invalid page tree&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">PageTreeNode</span>)
45: 
46:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">insert_page</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">page</span>)
47:       <span class="ruby-keyword kw">self</span>
48:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000511" class="method-detail">
        <a name="M000511"></a>

        <div class="method-heading">
          <a href="#M000511" class="method-signature">
          <span class="method-name">is_encrypted?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the <a href="PDF.html">PDF</a> file is encrypted.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000511-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000511-source">
<pre>
    <span class="ruby-comment cmt"># File origami/encryption.rb, line 46</span>
46:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_encrypted?</span>
47:       <span class="ruby-identifier">has_attr?</span> <span class="ruby-identifier">:Encrypt</span>
48:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000571" class="method-detail">
        <a name="M000571"></a>

        <div class="method-heading">
          <a href="#M000571" class="method-signature">
          <span class="method-name">is_linearized?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the current document is linearized.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000571-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000571-source">
<pre>
    <span class="ruby-comment cmt"># File origami/linearization.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_linearized?</span>
34:       <span class="ruby-keyword kw">begin</span>
35:         <span class="ruby-identifier">obj</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">objects</span>.<span class="ruby-identifier">sort_by</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">file_offset</span>}.<span class="ruby-identifier">first</span>
36:       <span class="ruby-keyword kw">rescue</span>
37:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
38:       <span class="ruby-keyword kw">end</span>
39: 
40:       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">:Linearized</span>
41:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000574" class="method-detail">
        <a name="M000574"></a>

        <div class="method-heading">
          <a href="#M000574" class="method-signature">
          <span class="method-name">is_signed?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the document contains a digital signature.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000574-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000574-source">
<pre>
     <span class="ruby-comment cmt"># File origami/signature.rb, line 120</span>
120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_signed?</span>
121:       <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> 
122:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:SigFlags</span>) <span class="ruby-keyword kw">and</span> 
123:       (<span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>[<span class="ruby-identifier">:SigFlags</span>].<span class="ruby-identifier">solve</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">InteractiveForm</span><span class="ruby-operator">::</span><span class="ruby-constant">SigFlags</span><span class="ruby-operator">::</span><span class="ruby-constant">SIGNATURESEXIST</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>)
124:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000530" class="method-detail">
        <a name="M000530"></a>

        <div class="method-heading">
          <a href="#M000530" class="method-signature">
          <span class="method-name">ls</span><span class="method-args">(*patterns)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of Objects whose name (in a <a
href="Dictionary.html">Dictionary</a>) is matching <em>pattern</em>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000530-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000530-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 366</span>
366:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ls</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">patterns</span>)
367:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">objects</span>(<span class="ruby-identifier">:include_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">empty?</span>
368: 
369:       <span class="ruby-identifier">result</span> = []
370: 
371:       <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
372:         <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">pattern</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">pattern</span>
373:       <span class="ruby-keyword kw">end</span>
374: 
375:       <span class="ruby-identifier">objects</span>(<span class="ruby-identifier">:only_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
376:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">any?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">pattern</span>) }
377:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">parent</span>[<span class="ruby-identifier">key</span>]
378:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> ( <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">solve</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span> )
379:         <span class="ruby-keyword kw">end</span>
380:       <span class="ruby-keyword kw">end</span>
381: 
382:       <span class="ruby-identifier">result</span>
383:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000559" class="method-detail">
        <a name="M000559"></a>

        <div class="method-heading">
          <a href="#M000559" class="method-signature">
          <span class="method-name">ls_names</span><span class="method-args">(root)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a Hash of all names under specified <em>root</em> name directory.
Returns nil if the directory does not exist.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000559-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000559-source">
<pre>
     <span class="ruby-comment cmt"># File origami/catalog.rb, line 183</span>
183:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ls_names</span>(<span class="ruby-identifier">root</span>)
184:       <span class="ruby-identifier">namesroot</span> = <span class="ruby-identifier">get_names_root</span>(<span class="ruby-identifier">root</span>)
185:       <span class="ruby-keyword kw">return</span> {} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namesroot</span>.<span class="ruby-identifier">nil?</span>
186: 
187:       <span class="ruby-identifier">names</span> = <span class="ruby-identifier">names_from_node</span>(<span class="ruby-identifier">namesroot</span>)
188:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
189:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">InvalidNameTreeError</span>, <span class="ruby-value str">&quot;Odd number of elements&quot;</span>
190:       <span class="ruby-keyword kw">end</span>
191: 
192:       <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">names</span>]
193:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000531" class="method-detail">
        <a name="M000531"></a>

        <div class="method-heading">
          <a href="#M000531" class="method-signature">
          <span class="method-name">ls_no_follow</span><span class="method-args">(*patterns)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of Objects whose name (in a <a
href="Dictionary.html">Dictionary</a>) is matching <em>pattern</em>. Do not
follow references.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000531-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000531-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 389</span>
389:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ls_no_follow</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">patterns</span>)
390:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">objects</span>(<span class="ruby-identifier">:include_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">empty?</span>
391: 
392:       <span class="ruby-identifier">result</span> = []
393: 
394:       <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
395:         <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">pattern</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">pattern</span>
396:       <span class="ruby-keyword kw">end</span>
397: 
398:       <span class="ruby-identifier">objects</span>(<span class="ruby-identifier">:only_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
399:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">any?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">pattern</span>) }
400:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">parent</span>[<span class="ruby-identifier">key</span>]
401:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
402:         <span class="ruby-keyword kw">end</span>
403:       <span class="ruby-keyword kw">end</span>
404: 
405:       <span class="ruby-identifier">result</span>
406:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000533" class="method-detail">
        <a name="M000533"></a>

        <div class="method-heading">
          <a href="#M000533" class="method-signature">
          <span class="method-name">objects</span><span class="method-args">(params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="PDF.html#M000533">objects</a> embedded in the
<a href="PDF.html">PDF</a> body.
</p>
<table>
<tr><td valign="top"><em>include_objstm</em>:</td><td>Whether it shall return <a href="PDF.html#M000533">objects</a> embedded in
object streams.

</td></tr>
</table>
<p>
Note : Shall return to an iterator for Ruby 1.9 comp.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000533-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000533-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 430</span>
430:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">objects</span>(<span class="ruby-identifier">params</span> = {})
431:       
432:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>)
433:         
434:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">o</span>) }.<span class="ruby-identifier">nil?</span>
435:           <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">root</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:only_keys</span>]
436: 
437:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
438:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
439:               <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:only_keys</span>]
440: 
441:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:include_keys</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:only_keys</span>]
442:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>)
443:             }
444:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:include_objectstreams</span>])
445:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">opts</span>) }
446:           <span class="ruby-keyword kw">end</span>
447:         <span class="ruby-keyword kw">end</span>
448:       <span class="ruby-keyword kw">end</span>
449: 
450:       <span class="ruby-identifier">options</span> =
451:       {
452:         <span class="ruby-identifier">:include_objectstreams</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
453:         <span class="ruby-identifier">:include_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
454:         <span class="ruby-identifier">:only_keys</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
455:       }
456:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
457: 
458:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_keys</span>] <span class="ruby-operator">|=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:only_keys</span>]
459:       
460:       <span class="ruby-identifier">objset</span> = []
461:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">revision</span><span class="ruby-operator">|</span>
462:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
463:             <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">options</span>)
464:         <span class="ruby-keyword kw">end</span>
465:       <span class="ruby-keyword kw">end</span>
466:       
467:       <span class="ruby-identifier">objset</span>
468:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000554" class="method-detail">
        <a name="M000554"></a>

        <div class="method-heading">
          <a href="#M000554" class="method-signature">
          <span class="method-name">onDocumentClose</span><span class="method-args">(action)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets an action to run on document closing.
</p>
<table>
<tr><td valign="top"><em>action</em>:</td><td>A JavaScript <a href="Action.html">Action</a> <a
href="Object.html">Object</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000554-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000554-source">
<pre>
     <span class="ruby-comment cmt"># File origami/catalog.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">onDocumentClose</span>(<span class="ruby-identifier">action</span>)
104:       
105:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">JavaScript</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
106:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;An Action::JavaScript object must be passed.&quot;</span>
107:       <span class="ruby-keyword kw">end</span>
108:       
109:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
110:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;A catalog object must exist to add this action.&quot;</span>
111:       <span class="ruby-keyword kw">end</span>
112:       
113:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">CatalogAdditionalActions</span>.<span class="ruby-identifier">new</span>
114:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span>.<span class="ruby-constant">WC</span> = <span class="ruby-identifier">action</span>
115:       
116:       <span class="ruby-keyword kw">self</span>
117:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000553" class="method-detail">
        <a name="M000553"></a>

        <div class="method-heading">
          <a href="#M000553" class="method-signature">
          <span class="method-name">onDocumentOpen</span><span class="method-args">(action)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets an action to run on document opening.
</p>
<table>
<tr><td valign="top"><em>action</em>:</td><td>An <a href="Action.html">Action</a> <a href="Object.html">Object</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000553-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000553-source">
<pre>
    <span class="ruby-comment cmt"># File origami/catalog.rb, line 84</span>
84:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">onDocumentOpen</span>(<span class="ruby-identifier">action</span>)   
85:       
86:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Action</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Destination</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
87:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;An Action object must be passed.&quot;</span>
88:       <span class="ruby-keyword kw">end</span>
89:       
90:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
91:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;A catalog object must exist to add this action.&quot;</span>
92:       <span class="ruby-keyword kw">end</span>
93:       
94:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">OpenAction</span> = <span class="ruby-identifier">action</span>
95:       
96:       <span class="ruby-keyword kw">self</span>
97:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000555" class="method-detail">
        <a name="M000555"></a>

        <div class="method-heading">
          <a href="#M000555" class="method-signature">
          <span class="method-name">onDocumentPrint</span><span class="method-args">(action)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets an action to run on document printing.
</p>
<table>
<tr><td valign="top"><em>action</em>:</td><td>A JavaScript <a href="Action.html">Action</a> <a
href="Object.html">Object</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000555-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000555-source">
<pre>
     <span class="ruby-comment cmt"># File origami/catalog.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">onDocumentPrint</span>(<span class="ruby-identifier">action</span>)
124:       
125:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">JavaScript</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
126:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;An Action::JavaScript object must be passed.&quot;</span>
127:       <span class="ruby-keyword kw">end</span>
128:       
129:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
130:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;A catalog object must exist to add this action.&quot;</span>
131:       <span class="ruby-keyword kw">end</span>
132:       
133:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">CatalogAdditionalActions</span>.<span class="ruby-identifier">new</span>
134:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span>.<span class="ruby-constant">WP</span> = <span class="ruby-identifier">action</span>
135:       
136:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000562" class="method-detail">
        <a name="M000562"></a>

        <div class="method-heading">
          <a href="#M000562" class="method-signature">
          <span class="method-name">pages</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="Page.html">Page</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000562-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000562-source">
<pre>
    <span class="ruby-comment cmt"># File origami/page.rb, line 53</span>
53:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pages</span>
54:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Invalid page tree&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">PageTreeNode</span>)
55:       
56:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>.<span class="ruby-identifier">children</span>
57:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000547" class="method-detail">
        <a name="M000547"></a>

        <div class="method-heading">
          <a href="#M000547" class="method-signature">
          <span class="method-name">physicalize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Converts a logical <a href="PDF.html">PDF</a> view into a physical view
ready for writing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000547-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000547-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 895</span>
895:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">physicalize</span>
896:      
897:       <span class="ruby-comment cmt">#</span>
898:       <span class="ruby-comment cmt"># Indirect objects are added to the revision and assigned numbers.</span>
899:       <span class="ruby-comment cmt">#</span>
900:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">revision</span>) <span class="ruby-comment cmt">#:nodoc:</span>
901: 
902:         <span class="ruby-comment cmt">#</span>
903:         <span class="ruby-comment cmt"># Finalize any subobjects before building the stream.</span>
904:         <span class="ruby-comment cmt">#</span>
905:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
906:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
907:             <span class="ruby-identifier">build</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
908:           <span class="ruby-keyword kw">end</span>
909:         <span class="ruby-keyword kw">end</span>
910:   
911:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">pre_build</span>
912: 
913:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
914:             
915:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
916:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_indirect?</span>
917:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_object</span>(<span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">reference</span>)
918:                   <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">reference</span>
919:                 <span class="ruby-keyword kw">else</span>
920:                   <span class="ruby-identifier">ref</span> = <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
921:                   <span class="ruby-identifier">build</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
922:                   <span class="ruby-identifier">ref</span>
923:                 <span class="ruby-keyword kw">end</span>
924:               <span class="ruby-keyword kw">else</span>
925:                 <span class="ruby-identifier">subobj</span>
926:               <span class="ruby-keyword kw">end</span>
927:             <span class="ruby-keyword kw">end</span>
928:             
929:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
930:               <span class="ruby-identifier">build</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
931:             <span class="ruby-keyword kw">end</span>
932:             
933:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
934:           <span class="ruby-identifier">build</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">dictionary</span>, <span class="ruby-identifier">revision</span>)
935:         <span class="ruby-keyword kw">end</span>
936: 
937:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">post_build</span>
938:         
939:       <span class="ruby-keyword kw">end</span>
940:       
941:       <span class="ruby-identifier">indirect_objects_by_rev</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span>, <span class="ruby-identifier">revision</span><span class="ruby-operator">|</span>
942:           <span class="ruby-identifier">build</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">revision</span>)          
943:       <span class="ruby-keyword kw">end</span>
944:       
945:       <span class="ruby-keyword kw">self</span>
946:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000543" class="method-detail">
        <a name="M000543"></a>

        <div class="method-heading">
          <a href="#M000543" class="method-signature">
          <span class="method-name">rebuildxrefs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Compute and update <a href="XRef/Section.html">XRef::Section</a> for each
<a href="PDF/Revision.html">Revision</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000543-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000543-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 744</span>
744:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rebuildxrefs</span>
745:       
746:       <span class="ruby-identifier">size</span> = <span class="ruby-value">0</span>
747:       <span class="ruby-identifier">startxref</span> = <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span>
748:       
749:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">revision</span><span class="ruby-operator">|</span>
750:       
751:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
752:           <span class="ruby-identifier">startxref</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span>
753:         <span class="ruby-keyword kw">end</span>
754:         
755:         <span class="ruby-identifier">size</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">size</span>
756:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">xreftable</span> = <span class="ruby-identifier">buildxrefs</span>(<span class="ruby-identifier">revision</span>.<span class="ruby-identifier">objects</span>)
757:         
758:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
759:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Size</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
760:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">startxref</span> = <span class="ruby-identifier">startxref</span>
761:         
762:         <span class="ruby-identifier">startxref</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">xreftable</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span>
763:       <span class="ruby-keyword kw">end</span>
764:       
765:       <span class="ruby-keyword kw">self</span>
766:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000556" class="method-detail">
        <a name="M000556"></a>

        <div class="method-heading">
          <a href="#M000556" class="method-signature">
          <span class="method-name">register</span><span class="method-args">(root, name, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Registers an object into a specific <a href="Names.html">Names</a> root
dictionary.
</p>
<table>
<tr><td valign="top"><em>root</em>:</td><td>The root dictionary (see <a href="Names/Root.html">Names::Root</a>)

</td></tr>
<tr><td valign="top"><em>name</em>:</td><td>The value name.

</td></tr>
<tr><td valign="top"><em>value</em>:</td><td>The value to associate with this name.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000556-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000556-source">
<pre>
     <span class="ruby-comment cmt"># File origami/catalog.rb, line 144</span>
144:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
145:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Names</span>.<span class="ruby-identifier">new</span>
146:       
147:       <span class="ruby-identifier">value</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Reference</span>
148:       
149:       <span class="ruby-identifier">namesroot</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span>[<span class="ruby-identifier">root</span>]
150:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namesroot</span>.<span class="ruby-identifier">nil?</span>
151:         <span class="ruby-identifier">names</span> = <span class="ruby-constant">NameTreeNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:Names</span> =<span class="ruby-operator">&gt;</span> []).<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
152:         <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span>[<span class="ruby-identifier">root</span>] = <span class="ruby-identifier">names</span>
153:         <span class="ruby-identifier">names</span>.<span class="ruby-constant">Names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
154:       <span class="ruby-keyword kw">else</span>
155:         <span class="ruby-identifier">namesroot</span>.<span class="ruby-identifier">solve</span>[<span class="ruby-identifier">:Names</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
156:       <span class="ruby-keyword kw">end</span>
157:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000545" class="method-detail">
        <a name="M000545"></a>

        <div class="method-heading">
          <a href="#M000545" class="method-signature">
          <span class="method-name">remove_revision</span><span class="method-args">(index)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes a whole document revision.
</p>
<table>
<tr><td valign="top"><em>index</em>:</td><td><a href="PDF/Revision.html">Revision</a> index, first is 0.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000545-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000545-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 786</span>
786:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_revision</span>(<span class="ruby-identifier">index</span>)
787:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span>
788:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-value str">&quot;Not a valid revision index&quot;</span>
789:       <span class="ruby-keyword kw">end</span>
790: 
791:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
792:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;Cannot remove last revision&quot;</span>
793:       <span class="ruby-keyword kw">end</span>
794: 
795:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">index</span>)
796:       <span class="ruby-keyword kw">self</span>
797:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000569" class="method-detail">
        <a name="M000569"></a>

        <div class="method-heading">
          <a href="#M000569" class="method-signature">
          <span class="method-name">remove_xrefs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to strip any xrefs information off the document.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000569-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000569-source">
<pre>
    <span class="ruby-comment cmt"># File origami/xreftable.rb, line 29</span>
29:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_xrefs</span>
30:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">xrefstm</span>)
31:         <span class="ruby-identifier">prev</span> = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Prev</span>
32:         <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">reference</span>)
33: 
34:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">prev_stm</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">prev</span>)).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>)
35:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">prev_stm</span>)
36:         <span class="ruby-keyword kw">end</span>
37:       <span class="ruby-keyword kw">end</span>
38: 
39:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">reverse_each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rev</span><span class="ruby-operator">|</span>
40:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">has_xrefstm?</span>
41:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span>)
42:         <span class="ruby-keyword kw">end</span>
43:         
44:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">has_dictionary?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">XRefStm</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
45:           <span class="ruby-identifier">xrefstm</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">XRefStm</span>)
46: 
47:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">xrefstm</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>)
48:         <span class="ruby-keyword kw">end</span>
49: 
50:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xreftable</span> = <span class="ruby-keyword kw">nil</span>
51:       <span class="ruby-keyword kw">end</span>
52:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000558" class="method-detail">
        <a name="M000558"></a>

        <div class="method-heading">
          <a href="#M000558" class="method-signature">
          <span class="method-name">resolve_name</span><span class="method-args">(root, name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Retrieve the corresponding value associated with <em>name</em> in the
specified <em>root</em> name directory, or nil if the value does not exist.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000558-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000558-source">
<pre>
     <span class="ruby-comment cmt"># File origami/catalog.rb, line 172</span>
172:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">resolve_name</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">name</span>)
173:       <span class="ruby-identifier">namesroot</span> = <span class="ruby-identifier">get_names_root</span>(<span class="ruby-identifier">root</span>)
174:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namesroot</span>.<span class="ruby-identifier">nil?</span>
175: 
176:       <span class="ruby-identifier">resolve_name_from_node</span>(<span class="ruby-identifier">namesroot</span>, <span class="ruby-identifier">name</span>)
177:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000536" class="method-detail">
        <a name="M000536"></a>

        <div class="method-heading">
          <span class="method-name">root_objects</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="PDF.html#M000535">indirect_objects</a>
</p>
        </div>
      </div>

      <div id="method-M000527" class="method-detail">
        <a name="M000527"></a>

        <div class="method-heading">
          <a href="#M000527" class="method-signature">
          <span class="method-name">save</span><span class="method-args">(path, params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Saves the current document.
</p>
<table>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000527">save</a> this <a
href="PDF.html">PDF</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000527-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000527-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 244</span>
244:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">params</span> = {})
245:       
246:       <span class="ruby-identifier">options</span> = 
247:       {
248:         <span class="ruby-identifier">:delinearize</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
249:         <span class="ruby-identifier">:recompile</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
250:         <span class="ruby-identifier">:decrypt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
251:       }
252:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
253: 
254:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">frozen?</span> <span class="ruby-comment cmt"># incompatible flags with frozen doc (signed)</span>
255:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:recompile</span>] = 
256:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] = 
257:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:noindent</span>] = 
258:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:obfuscate</span>] = <span class="ruby-keyword kw">false</span>
259:       <span class="ruby-keyword kw">end</span>
260:       
261:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:write</span>)
262:         <span class="ruby-identifier">fd</span> = <span class="ruby-identifier">path</span>
263:       <span class="ruby-keyword kw">else</span>
264:         <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-value str">'w'</span>).<span class="ruby-identifier">binmode</span>
265:       <span class="ruby-keyword kw">end</span>
266:       
267:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">delinearize!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:delinearize</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_linearized?</span>
268:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:recompile</span>]
269: 
270:       <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">write</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>(<span class="ruby-identifier">options</span>)
271:       <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span>
272:       
273:       <span class="ruby-keyword kw">self</span>
274:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000529" class="method-detail">
        <a name="M000529"></a>

        <div class="method-heading">
          <a href="#M000529" class="method-signature">
          <span class="method-name">save_upto</span><span class="method-args">(revision, filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Saves the file up to given revision number. This can be useful to visualize
the modifications over different incremental updates.
</p>
<table>
<tr><td valign="top"><em>revision</em>:</td><td>The revision number to <a href="PDF.html#M000527">save</a>.

</td></tr>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000527">save</a> this <a
href="PDF.html">PDF</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000529-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000529-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 283</span>
283:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_upto</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">filename</span>)
284:       <span class="ruby-identifier">save</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">:up_to_revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">revision</span>)  
285:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000528" class="method-detail">
        <a name="M000528"></a>

        <div class="method-heading">
          <span class="method-name">saveas</span><span class="method-args">(path, params = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="PDF.html#M000527">save</a>
</p>
        </div>
      </div>

      <div id="method-M000525" class="method-detail">
        <a name="M000525"></a>

        <div class="method-heading">
          <a href="#M000525" class="method-signature">
          <span class="method-name">serialize</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Serializes the current <a href="PDF.html">PDF</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000525-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000525-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 225</span>
225:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">serialize</span>(<span class="ruby-identifier">filename</span>)
226:         <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">gz</span><span class="ruby-operator">|</span>
227:           <span class="ruby-identifier">gz</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-keyword kw">self</span>)
228:         }
229:         
230:         <span class="ruby-keyword kw">self</span>
231:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000550" class="method-detail">
        <a name="M000550"></a>

        <div class="method-heading">
          <a href="#M000550" class="method-signature">
          <span class="method-name">set_extension_level</span><span class="method-args">(version, level)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets <a href="PDF.html">PDF</a> extension level and version. Only supported
values are &quot;1.7&quot; and 3.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000550-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000550-source">
<pre>
    <span class="ruby-comment cmt"># File origami/catalog.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_extension_level</span>(<span class="ruby-identifier">version</span>, <span class="ruby-identifier">level</span>)
34:       <span class="ruby-identifier">exts</span> = (<span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Extensions</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Extensions</span>.<span class="ruby-identifier">new</span>)
35: 
36:       <span class="ruby-identifier">exts</span>[<span class="ruby-identifier">:ADBE</span>] = <span class="ruby-constant">DeveloperExtension</span>.<span class="ruby-identifier">new</span>
37:       <span class="ruby-identifier">exts</span>[<span class="ruby-identifier">:ADBE</span>].<span class="ruby-constant">BaseVersion</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">version</span>)
38:       <span class="ruby-identifier">exts</span>[<span class="ruby-identifier">:ADBE</span>].<span class="ruby-constant">ExtensionLevel</span> = <span class="ruby-identifier">level</span>
39: 
40:       <span class="ruby-keyword kw">self</span>
41:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000573" class="method-detail">
        <a name="M000573"></a>

        <div class="method-heading">
          <a href="#M000573" class="method-signature">
          <span class="method-name">sign</span><span class="method-args">(certificate, key, ca = [], annotation = nil, location = nil, contact = nil, reason = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sign the document with the given key and x509 certificate.
</p>
<table>
<tr><td valign="top"><em>certificate</em>:</td><td>The X509 certificate containing the public key.

</td></tr>
<tr><td valign="top"><em>key</em>:</td><td>The private key associated with the certificate.

</td></tr>
<tr><td valign="top"><em>ca</em>:</td><td>Optional CA certificates used to <a href="PDF.html#M000573">sign</a> the
user certificate.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000573-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000573-source">
<pre>
     <span class="ruby-comment cmt"># File origami/signature.rb, line 32</span>
 32:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span> = [], <span class="ruby-identifier">annotation</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">location</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">contact</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">reason</span> = <span class="ruby-keyword kw">nil</span>)
 33:       
 34:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Origami</span><span class="ruby-operator">::</span><span class="ruby-constant">OPTIONS</span>[<span class="ruby-identifier">:use_openssl</span>]
 35:         <span class="ruby-identifier">fail</span> <span class="ruby-value str">&quot;OpenSSL is not present or has been disabled.&quot;</span>
 36:       <span class="ruby-keyword kw">end</span>
 37:       
 38:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">certificate</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>)
 39:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;A OpenSSL::X509::Certificate object must be passed.&quot;</span>
 40:       <span class="ruby-keyword kw">end</span>
 41:       
 42:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>)
 43:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;A OpenSSL::PKey::RSA object must be passed.&quot;</span>
 44:       <span class="ruby-keyword kw">end</span>
 45:       
 46:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ca</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
 47:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected an Array of CA certificate.&quot;</span>
 48:       <span class="ruby-keyword kw">end</span>
 49:       
 50:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">annotation</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">annotation</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Annotation</span><span class="ruby-operator">::</span><span class="ruby-constant">Widget</span><span class="ruby-operator">::</span><span class="ruby-constant">Signature</span>)
 51:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected a Annotation::Widget::Signature object.&quot;</span>
 52:       <span class="ruby-keyword kw">end</span>
 53:       
 54:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span> = []) <span class="ruby-comment cmt">#;nodoc:</span>
 55:         <span class="ruby-identifier">datatest</span> = <span class="ruby-value str">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
 56:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">datatest</span>, <span class="ruby-identifier">ca</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">128</span>
 57:       <span class="ruby-keyword kw">end</span>
 58:       
 59:       <span class="ruby-identifier">digsig</span> = <span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">DigitalSignature</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
 60:      
 61:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">annotation</span>.<span class="ruby-identifier">nil?</span>
 62:         <span class="ruby-identifier">annotation</span> = <span class="ruby-constant">Annotation</span><span class="ruby-operator">::</span><span class="ruby-constant">Widget</span><span class="ruby-operator">::</span><span class="ruby-constant">Signature</span>.<span class="ruby-identifier">new</span>
 63:         <span class="ruby-identifier">annotation</span>.<span class="ruby-constant">Rect</span> = <span class="ruby-constant">Rectangle</span>[<span class="ruby-identifier">:llx</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-identifier">:lly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-identifier">:urx</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-identifier">:ury</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>]        
 64:       <span class="ruby-keyword kw">end</span>
 65:       
 66:       <span class="ruby-identifier">annotation</span>.<span class="ruby-constant">V</span> = <span class="ruby-identifier">digsig</span> ;
 67:       <span class="ruby-identifier">add_fields</span>(<span class="ruby-identifier">annotation</span>)
 68:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-constant">SigFlags</span> = <span class="ruby-constant">InteractiveForm</span><span class="ruby-operator">::</span><span class="ruby-constant">SigFlags</span><span class="ruby-operator">::</span><span class="ruby-constant">SIGNATURESEXIST</span> <span class="ruby-operator">|</span> <span class="ruby-constant">InteractiveForm</span><span class="ruby-operator">::</span><span class="ruby-constant">SigFlags</span><span class="ruby-operator">::</span><span class="ruby-constant">APPENDONLY</span>
 69:       
 70:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:Sig</span> <span class="ruby-comment cmt">#:nodoc:</span>
 71:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;\x00&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span>)) <span class="ruby-comment cmt">#:nodoc:</span>
 72:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Filter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Adobe.PPKMS&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 73:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">SubFilter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;adbe.pkcs7.detached&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 74:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span> = [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-comment cmt">#:nodoc:</span>
 75:       
 76:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Location</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">location</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">location</span>
 77:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ContactInfo</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">contact</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">contact</span>
 78:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Reason</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">reason</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reason</span>
 79:       
 80:       <span class="ruby-comment cmt">#</span>
 81:       <span class="ruby-comment cmt">#  Flattening the PDF to get file view.</span>
 82:       <span class="ruby-comment cmt">#</span>
 83:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span>
 84:       
 85:       <span class="ruby-comment cmt">#</span>
 86:       <span class="ruby-comment cmt"># Creating an empty Xref table to compute signature byte range.</span>
 87:       <span class="ruby-comment cmt">#</span>
 88:       <span class="ruby-identifier">rebuild_dummy_xrefs</span>
 89:       
 90:       <span class="ruby-identifier">sigoffset</span> = <span class="ruby-identifier">get_object_offset</span>(<span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">generation</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">sigOffset</span>
 91:       
 92:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>] = <span class="ruby-value">0</span> 
 93:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">sigoffset</span>
 94:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">sigoffset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>.<span class="ruby-identifier">size</span>
 95:       
 96:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] = <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>]
 97:       
 98:       <span class="ruby-comment cmt"># From that point the file size remains constant</span>
 99:       
100:       <span class="ruby-comment cmt">#</span>
101:       <span class="ruby-comment cmt"># Correct Xrefs variations caused by ByteRange modifications.</span>
102:       <span class="ruby-comment cmt">#</span>
103:       <span class="ruby-identifier">rebuildxrefs</span>
104:       
105:       <span class="ruby-identifier">filedata</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>
106:       <span class="ruby-identifier">signable_data</span> = <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>]] <span class="ruby-operator">+</span> <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>]]
107:       
108:       <span class="ruby-identifier">signature</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">signable_data</span>, <span class="ruby-identifier">ca</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>
109:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">signature</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">signature</span>
110:       
111:       <span class="ruby-comment cmt">#</span>
112:       <span class="ruby-comment cmt"># No more modification are allowed after signing.</span>
113:       <span class="ruby-comment cmt">#</span>
114:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">freeze</span>
115:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000542" class="method-detail">
        <a name="M000542"></a>

        <div class="method-heading">
          <a href="#M000542" class="method-signature">
          <span class="method-name">to_bin</span><span class="method-args">(params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the final binary representation of the current document.
</p>
<table>
<tr><td valign="top"><em><a href="PDF.html#M000543">rebuildxrefs</a></em>:</td><td>Computes xrefs while writing <a href="PDF.html#M000533">objects</a>
(default true).

</td></tr>
<tr><td valign="top"><em>obfuscate</em>:</td><td>Do some basic syntactic object obfuscation.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000542-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000542-source">
<pre>
     <span class="ruby-comment cmt"># File origami/pdf.rb, line 567</span>
567:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_bin</span>(<span class="ruby-identifier">params</span> = {})
568:    
569:       <span class="ruby-identifier">has_objstm</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)}
570: 
571:       <span class="ruby-identifier">options</span> =
572:       {
573:         <span class="ruby-identifier">:rebuildxrefs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
574:         <span class="ruby-identifier">:noindent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
575:         <span class="ruby-identifier">:obfuscate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
576:         <span class="ruby-identifier">:use_xrefstm</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">has_objstm</span>,
577:         <span class="ruby-identifier">:use_xreftable</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">has_objstm</span>),
578:         <span class="ruby-identifier">:up_to_revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span>
579:       }
580:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
581: 
582:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:up_to_revision</span>] = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:up_to_revision</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span>
583: 
584:       <span class="ruby-comment cmt"># Reset to default params if no xrefs are chosen (hybrid files not supported yet)</span>
585:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>]
586:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] = <span class="ruby-identifier">has_objstm</span>
587:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] = (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">has_objstm</span>)
588:       <span class="ruby-keyword kw">end</span>
589: 
590:       <span class="ruby-comment cmt"># Get trailer dictionary</span>
591:       <span class="ruby-identifier">trailer_info</span> = <span class="ruby-identifier">get_trailer_info</span>
592:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">trailer_info</span>.<span class="ruby-identifier">nil?</span>
593:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDFError</span>, <span class="ruby-value str">&quot;No trailer information found&quot;</span>
594:       <span class="ruby-keyword kw">end</span>
595:       <span class="ruby-identifier">trailer_dict</span> = <span class="ruby-identifier">trailer_info</span>.<span class="ruby-identifier">dictionary</span>
596:  
597:       <span class="ruby-identifier">prev_xref_offset</span> = <span class="ruby-keyword kw">nil</span>
598:       <span class="ruby-identifier">xrefstm_offset</span> = <span class="ruby-keyword kw">nil</span>
599:       <span class="ruby-identifier">xreftable_offset</span> = <span class="ruby-keyword kw">nil</span>
600:     
601:       <span class="ruby-comment cmt"># Header</span>
602:       <span class="ruby-identifier">bin</span> = <span class="ruby-value str">&quot;&quot;</span>
603:       <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">to_s</span>
604:       
605:       <span class="ruby-comment cmt"># For each revision</span>
606:       <span class="ruby-ivar">@revisions</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:up_to_revision</span>]].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rev</span><span class="ruby-operator">|</span>
607:         
608:         <span class="ruby-comment cmt"># Create xref table/stream.</span>
609:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
610:           <span class="ruby-identifier">lastno_table</span>, <span class="ruby-identifier">lastno_stm</span> = <span class="ruby-value">0</span>, <span class="ruby-value">0</span>
611:           <span class="ruby-identifier">brange_table</span>, <span class="ruby-identifier">brange_stm</span> = <span class="ruby-value">0</span>, <span class="ruby-value">0</span>
612:           
613:           <span class="ruby-identifier">xrefs_stm</span> = [ <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">FREE</span>) ]
614:           <span class="ruby-identifier">xrefs_table</span> = [ <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">FIRSTFREE</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">FREE</span>) ]
615: 
616:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
617:             <span class="ruby-identifier">xrefsection</span> = <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">Section</span>.<span class="ruby-identifier">new</span>
618:           <span class="ruby-keyword kw">end</span>
619: 
620:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
621:             <span class="ruby-identifier">xrefstm</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">||</span> <span class="ruby-constant">XRefStream</span>.<span class="ruby-identifier">new</span>
622:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span>
623:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">clear</span>
624:             <span class="ruby-keyword kw">else</span>
625:               <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">xrefstm</span>, <span class="ruby-identifier">rev</span>) 
626:             <span class="ruby-keyword kw">end</span>
627:           <span class="ruby-keyword kw">end</span>
628:         <span class="ruby-keyword kw">end</span>
629:        
630:         <span class="ruby-identifier">objset</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">objects</span>
631:         
632:         <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find_all</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)}.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">objstm</span><span class="ruby-operator">|</span>
633:           <span class="ruby-identifier">objset</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">objstm</span>.<span class="ruby-identifier">objects</span>
634:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
635: 
636:         <span class="ruby-comment cmt"># For each object, in number order</span>
637:         <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
638:          
639:           <span class="ruby-comment cmt"># Create xref entry.</span>
640:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
641:            
642:             <span class="ruby-comment cmt"># Adding subsections if needed</span>
643:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lastno_table</span>).<span class="ruby-identifier">abs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
644:               <span class="ruby-identifier">xrefsection</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">Subsection</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">brange_table</span>, <span class="ruby-identifier">xrefs_table</span>)
645: 
646:               <span class="ruby-identifier">xrefs_table</span>.<span class="ruby-identifier">clear</span>
647:               <span class="ruby-identifier">brange_table</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
648:             <span class="ruby-keyword kw">end</span>
649:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lastno_stm</span>).<span class="ruby-identifier">abs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
650:               <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">xref</span><span class="ruby-operator">|</span> <span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xref</span> <span class="ruby-keyword kw">end</span>
651:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">||=</span> []
652:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">brange_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">length</span>
653: 
654:               <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">clear</span>
655:               <span class="ruby-identifier">brange_stm</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
656:             <span class="ruby-keyword kw">end</span>
657: 
658:             <span class="ruby-comment cmt"># Process embedded objects</span>
659:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
660:               <span class="ruby-identifier">index</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>)
661:              
662:               <span class="ruby-identifier">xrefs_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRefToCompressedObj</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">index</span>)
663:               
664:               <span class="ruby-identifier">lastno_stm</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
665:             <span class="ruby-keyword kw">else</span>
666:               <span class="ruby-identifier">xrefs_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">generation</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">USED</span>)
667:               <span class="ruby-identifier">xrefs_table</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">generation</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">USED</span>)
668: 
669:               <span class="ruby-identifier">lastno_table</span> = <span class="ruby-identifier">lastno_stm</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
670:             <span class="ruby-keyword kw">end</span>
671: 
672:           <span class="ruby-keyword kw">end</span>
673:          
674:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
675:            
676:             <span class="ruby-comment cmt"># Finalize XRefStm</span>
677:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">xrefstm</span>
678:               <span class="ruby-identifier">xrefstm_offset</span> = <span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>
679:    
680:               <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">xref</span><span class="ruby-operator">|</span> <span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xref</span> <span class="ruby-keyword kw">end</span>
681: 
682:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">W</span> = [ <span class="ruby-value">1</span>, (<span class="ruby-identifier">xrefstm_offset</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">7</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">3</span>, <span class="ruby-value">2</span> ]
683:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">DecodeParms</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">DecodeParms</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:Columns</span>)
684:                 <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">DecodeParms</span>[<span class="ruby-identifier">:Columns</span>] = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">W</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">W</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">W</span>[<span class="ruby-value">2</span>]
685:               <span class="ruby-keyword kw">end</span>
686: 
687:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">||=</span> []
688:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">brange_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">size</span>
689:    
690:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">dictionary</span> = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">trailer_dict</span>) 
691:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Prev</span> = <span class="ruby-identifier">prev_xref_offset</span>
692:               <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">dictionary</span> = <span class="ruby-keyword kw">nil</span>
693: 
694:               <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">xrefstm</span>, <span class="ruby-identifier">rev</span>)
695: 
696:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">pre_build</span>
697:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">post_build</span>
698:             <span class="ruby-keyword kw">end</span>
699: 
700:             <span class="ruby-comment cmt"># Output object code</span>
701:             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:noindent</span>]
702:               <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">0</span>)
703:             <span class="ruby-keyword kw">else</span>
704:               <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">to_s</span>
705:             <span class="ruby-keyword kw">end</span>
706:           <span class="ruby-keyword kw">end</span>
707:         <span class="ruby-keyword kw">end</span>
708:       
709:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
710:         
711:         <span class="ruby-comment cmt"># XRef table</span>
712:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
713:  
714:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
715:             <span class="ruby-identifier">table_offset</span> = <span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>
716:             
717:             <span class="ruby-identifier">xrefsection</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">Subsection</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">brange_table</span>, <span class="ruby-identifier">xrefs_table</span>)
718:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xreftable</span> = <span class="ruby-identifier">xrefsection</span>
719:  
720:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">dictionary</span> = <span class="ruby-identifier">trailer_dict</span>
721:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Size</span> = <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
722:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Prev</span> = <span class="ruby-identifier">prev_xref_offset</span>
723: 
724:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">XRefStm</span> = <span class="ruby-identifier">xrefstm_offset</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
725:           <span class="ruby-keyword kw">end</span>
726: 
727:           <span class="ruby-identifier">startxref</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">table_offset</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">xrefstm_offset</span>
728:           <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">startxref</span> = <span class="ruby-identifier">prev_xref_offset</span> = <span class="ruby-identifier">startxref</span>
729: 
730:         <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># end each rev</span>
731:         
732:         <span class="ruby-comment cmt"># Trailer</span>
733:         <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xreftable</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
734:         <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:obfuscate</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">to_obfuscated_str</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">to_s</span>)
735:         
736:       <span class="ruby-keyword kw">end</span>
737:       
738:       <span class="ruby-identifier">bin</span>
739:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>